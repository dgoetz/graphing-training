<!DOCTYPE HTML>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title></title>

  
    <link rel="icon" href="image/global/favicon.ico"/>
  

  
    
      <link rel="stylesheet" href=".//css/font-awesome-4.4.0/css/font-awesome.min.css" type="text/css"/>
    
      <link rel="stylesheet" href=".//css/mermaid-6.0.0.css" type="text/css"/>
    
      <link rel="stylesheet" href=".//css/highlight/default.css" type="text/css"/>
    
      <link rel="stylesheet" href=".//css/showoff.css" type="text/css"/>
    
      <link rel="stylesheet" href=".//css/onepage.css" type="text/css"/>
    

    
      <link rel="stylesheet" href=".//file/netways.css" type="text/css"/>
    

    
      <script type="text/javascript" src=".//js/jquery-2.1.4.min.js"></script>
    
      <script type="text/javascript" src=".//js/showoff.js"></script>
    
      <script type="text/javascript" src=".//js/highlight.pack-9.2.0.js"></script>
    
      <script type="text/javascript" src=".//js/bigtext-0.1.8.js"></script>
    
      <script type="text/javascript" src=".//js/simpleStrings-0.0.1.js"></script>
    
      <script type="text/javascript" src=".//js/mermaid-6.0.0-min.js"></script>
    
    
    

  

  <script type="text/javascript">
    $(document).ready(function() {
      $('pre.highlight code').each(function(i, block) {
        try {
          // syntax highlight the code
          hljs.highlightBlock(block);

          // then add focus on any lines marked
          highlightLines(block);
        } catch(e) {
          console.log('Syntax highlighting failed on ' + $(this).closest('div.slide').attr('id'));
          console.log('Syntax highlighting failed for ' + $(this).attr('class'));
          console.log(e);
        }
      });


      // render diagrams and text manipulations unconditionally instead of waiting for slide views
      mermaid.init(undefined, $(".language-render-diagram"));
      $('.content.bigtext').bigtext();

      // translate SVG images, inlining them first if needed.
      user_translations = {
};
      $('img').simpleStrings({strings: user_translations});
      $('svg').simpleStrings({strings: user_translations});
      $('.translate').simpleStrings({strings: user_translations});
    });
  </script>

</head>

<body>
<div id="slides" >
  <div data-section="global/pre/netways/title" data-title="00_title" id="global_pre_netways_title_00_title1" class="slide printonly" data-transition="none">
<div class="content printonly" ref="global/pre/netways/title/00_title:1">
<h1 class="section_title">Graphite + Grafana</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<div class="title-logo">
    <img src="./file///global/pre/netways/_images/netways-logo-1366.png" alt="NETWAYS width=" height="68px">
</div>

<div class="title-cover">
    <div class="title-name">Graphite + Grafana</div>
    <div class="title-subtitle">Time Series Metrics</div>
    <div class="title-release">Version: 2.1.1</div>
</div>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="global/pre/hints" data-title="00_hints" id="global_pre_hints_00_hints" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="global/pre/hints/00_hints">
<h1 class="section_title">Graphite + Grafana</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Training Hints</h1>

<ul>
<li>Ask questions! Dumb questions do not exist.</li>
<li>Add your own notes! Having learnt something is reflected best with your own additions.</li>
<li>Join the conversation! Many of these exercises require real world scenarios and your feedback and questions.</li>
<li>Work together! Be part of the training team and find solutions together.</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/introduction/" data-title="01_what" id="sections_introduction_01_what1" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/introduction/01_what:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Performance Graphing</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>1 Performance Graphing</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/introduction/" data-title="01_what" id="sections_introduction_01_what2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/introduction/01_what:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Performance Graphing</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>What it is</h1>

<ul>
<li>All about numbers and time</li>
<li>Collect and store data</li>
<li>View the past</li>
<li>Predict trends</li>
<li>View the state of something</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/introduction/" data-title="01_what" id="sections_introduction_01_what3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/introduction/01_what:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Performance Graphing</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>What it is not</h1>

<ul>
<li>Alerting in any way</li>
<li>Telling you what the problem is</li>
<li>Telling you how to solve it</li>
<li>You are the interpreter</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/introduction/" data-title="02_why_and_where" id="sections_introduction_02_why_and_where1" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/introduction/02_why_and_where:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Why we need graphs</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>2 Why we need graphs</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/introduction/" data-title="02_why_and_where" id="sections_introduction_02_why_and_where2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/introduction/02_why_and_where:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Why we need graphs</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Why Operators need it</h1>

<ul>
<li>State of single server or application</li>
<li>Correlate the state of multiple servers</li>
<li>Network usage</li>
<li>Trace problems</li>
<li>Transparancy of the data center

<ul>
<li>Load</li>
<li>Disk</li>
<li>Processes</li>
<li>Memory</li>
<li>...</li>
</ul>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/introduction/" data-title="02_why_and_where" id="sections_introduction_02_why_and_where3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/introduction/02_why_and_where:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Why we need graphs</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Why Devs need it</h1>

<ul>
<li>Debugging</li>
<li>Application profiling</li>
<li>Trace performance issues </li>
<li>Follow impacts of application changes</li>
<li>Follow impacts of growing usage</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/introduction/" data-title="02_why_and_where" id="sections_introduction_02_why_and_where4" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/introduction/02_why_and_where:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Why we need graphs</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Why Managers need it</h1>

<ul>
<li>Service Level Agreements (SLAs)</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/introduction/" data-title="02_why_and_where" id="sections_introduction_02_why_and_where5" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/introduction/02_why_and_where:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Why we need graphs</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Why all of us need it</h1>

<ul>
<li>Capacity Management

<ul>
<li>Storage</li>
<li>Network</li>
<li>Temperature</li>
<li>Consumption of electricity</li>
<li>Rack space</li>
<li>...</li>
</ul>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="00_title" id="sections_graphite_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/graphite/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>3 Graphite</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="01_overview" id="sections_graphite_01_overview" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/graphite/01_overview">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite Overview</h1>

<ul>
<li>Store numeric time-series data</li>
<li>Render graphs of this data on demand</li>
<li>No collection of data</li>
<li>Written in Python</li>
</ul>

<p>Graphite is not just a single product, it consists of multiple components which work together to build a complete performance monitoring solution.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Website: <a href="https://graphiteapp.org" target="_blank">https://graphiteapp.org</a><br>
Project: <a href="https://github.com/graphite-project" target="_blank">https://github.com/graphite-project</a><br>
Docs: <a href="http://graphite.readthedocs.io" target="_blank">http://graphite.readthedocs.io</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="02_basic-components" id="sections_graphite_02_basic-components1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/graphite/02_basic-components:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>3.1 Basic Components</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="02_basic-components" id="sections_graphite_02_basic-components2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/graphite/02_basic-components:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Components of Graphite</h1>

<p>Graphite is a scalable system which provides realtime graphing. Graphite was originally developed by Chris Davis from orbitz.com, where it was used to visualize business-critical data. Graphite is not a single application, it consists of multiple components which together provide a fully functional performance monitoring solution.</p>

<p>Parts of Graphite:</p>

<ul>
<li>Carbon</li>
<li>Whisper</li>
<li>Graphite-Web</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Graphite was published in 2008 under the "Apache 2.0" license.</p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="02_basic-components" id="sections_graphite_02_basic-components3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/graphite/02_basic-components:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Cache</h1>

<ul>
<li>Accepts metrics over TCP or UDP</li>
<li>Various protocols

<ul>
<li>Plaintext</li>
<li>Python pickle</li>
<li>AMQP</li>
</ul>
</li>
<li>Caches metrics and writes data to disk</li>
<li>Provides query port "Carbonlink" (in-memory metrics)</li>
</ul>

<p>Carbon Cache accepts metrics and provides a mechanism to cache those for a defined amount of time. It uses the underlying Whisper libraries to store permanently to disk. In a growing environment with more I/O a single <code>carbon-cache</code> process may not be enough. To scale you can simply spawn multiple Carbon Caches.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="02_basic-components" id="sections_graphite_02_basic-components4" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/graphite/02_basic-components:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-Web</h1>

<ul>
<li>Webinterface (Django)</li>
<li>Render graphs</li>
<li>Save graphs in dashboards</li>
<li>Share graphs</li>
</ul>

<p>Graphite-Web is the visualizing component. To create graphics, it obtains the data simultaneously from the related Whisper files and the Carbon Cache. Graphite-Web combines data points from both sources and returns a single image. By doing this it ensures that data always can be shown in real time, even if some data points are not written yet into Whisper files and therefore written on the hard drive.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="03_single-node-setup" id="sections_graphite_03_single-node-setup1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/graphite/03_single-node-setup:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>3.2 Single-Node Setup</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="03_single-node-setup" id="sections_graphite_03_single-node-setup2" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/graphite/03_single-node-setup:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Single-Node Setup</h1>

<p></p>
<center><img src="./file//sections/graphite/_images/graphite-single-node.png" style="width:95%"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="04_vms" id="sections_graphite_04_vms1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/graphite/04_vms:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>3.3 Virtual Machines</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="04_vms" id="sections_graphite_04_vms2" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/04_vms:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Training VMs</h1>

<ul>
<li>VirtualBox</li>
<li>Host-only network (192.168.56.0/24)</li>
<li>"graphing1.localdomain" is the primary training VM</li>
<li>"graphing2.localdomain" is used for Cluster setup</li>
</ul>

<table>
<thead>
<tr>
<th>Instance</th>
<th>IP</th>
<th>Login</th>
</tr>
</thead>
<tbody>
<tr>
<td>graphing1.localdomain</td>
<td>192.168.56.101</td>
<td>training/netways (sudo su)</td>
</tr>
<tr>
<td>graphing2.localdomain</td>
<td>192.168.56.102</td>
<td>training/netways (sudo su)</td>
</tr>
</tbody>
</table>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>VirtualBox user manual: <a href="https://www.virtualbox.org/manual/UserManual.html" target="_blank">https://www.virtualbox.org/manual/UserManual.html</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="04_vms" id="sections_graphite_04_vms3" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/04_vms:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Base Linux Installation</h1>

<ul>
<li>CentOS 7</li>
<li>
<strong>Systemd</strong> as init system</li>
<li>
<strong>Firewalld</strong> (Stopped)</li>
<li>
<strong>SELinux</strong> (Permissive)</li>
<li>EPEL repository for additional packages</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/graphite/05_installation:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>3.4 Graphite Installation</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/graphite/05_installation:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Installation methods</h1>

<ul>
<li>Installation from source</li>
<li>Installation from PyPI (Python Package Index) via pip</li>
<li>Installation via binary packages

<ul>
<li>Most common operating systems</li>
</ul>
</li>
<li>Installation in isolated Python environment with Virtualenv</li>
<li>Script based installation with Synthesize (Vagrant)</li>
<li>Installation with configuration management tools

<ul>
<li>Puppet</li>
<li>Ansible</li>
<li>Chef</li>
<li>Salt</li>
</ul>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/graphite/05_installation:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Installation via Puppet</h1>

<ul>
<li>Configuration management solution</li>
<li>Supports multiple operating systems

<ul>
<li>RedHat, CentOS, Debian, Ubuntu, SLES, Oracle Linux, ...</li>
</ul>
</li>
<li>Covers all common Graphite options</li>
<li>Fully automated installation of all components</li>
<li>Optional: Installation of webserver</li>
</ul>

<p>Puppet module: <a href="https://forge.puppetlabs.com/dwerder/graphite" target="_blank">https://forge.puppetlabs.com/dwerder/graphite</a></p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation4" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>PyPI vs. Binary Package Installation</h1>

<p>PyPI:</p>

<ul>
<li>All versions and features available</li>
<li>More installation and configuration effort</li>
<li>More flexibility</li>
<li>Harder to debug</li>
</ul>

<p>Binary package:</p>

<ul>
<li>Availability depends on the operating system</li>
<li>Older and more stable versions</li>
<li>Easier to install</li>
</ul>

<p>In this course we've decided to do the installation from PyPI via pip. So the attendees will get a better understanding of the Graphite components and how they work together.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation5" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Prerequisites</h1>

<p>To prepare the Graphite installation we need to install some required packages first:</p>

<pre class="highlight"><code class="language-sh"># yum -y install python2-pip gcc
# yum -y install python-devel cairo-devel libffi-devel</code></pre>

<p>Required packages for Graphite-Web:</p>

<pre class="highlight"><code class="language-sh"># yum -y install python-scandir mod_wsgi httpd
# yum -y install dejavu-sans-fonts dejavu-serif-fonts</code></pre>

<p>An exported shell variable will simplify the navigation when copying or moving files around:</p>

<pre class="highlight"><code class="language-sh"># export GRAPHITE=/opt/graphite</code></pre>

<p><strong>Note:</strong> All package requirements for Graphite and Graphite-Web are already pre-installed on "graphing1.localdomain".</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation6" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Installation via PyPI</h1>

<p>After all requirements are fulfilled, the installation of the Graphite components via PyPI is pretty simple:</p>

<pre class="highlight"><code class="language-sh"># pip install carbon==1.1.3
# pip install whisper==1.1.3
# pip install graphite-web==1.1.3</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation7" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Python Packages</h1>

<p>Due to a bug in Carbon and Graphite-Web &gt;= 1.0.0 Python packages are not stored correctly, so we create symlinks as workaround:</p>

<pre class="highlight"><code class="language-sh"># ln -s $GRAPHITE/lib/carbon-1.1.3-py2.7.egg-info/ \
/usr/lib/python2.7/site-packages/
# ln -s /opt/graphite/webapp/graphite_web-1.1.3\
-py2.7.egg-info/ /usr/lib/python2.7/site-packages/</code></pre>

<p>Finally <code>pip</code> should list the installed Graphite packages:</p>

<pre class="highlight"><code class="language-sh"># pip list
...
carbon (1.1.3)
graphite-web (1.1.3)
whisper (1.1.3)</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation8" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:8">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Cache Configuration</h1>

<p>All variations of the Carbon daemon (Cache, Aggregator and Relay) require some basic configuration. The PyPI packages provide for each configuration file at least one example. To be able to start Carbon Cache we need to copy at least two config files.</p>

<pre class="highlight"><code class="language-sh"># cp $GRAPHITE/conf/carbon.conf.example \
$GRAPHITE/conf/carbon.conf</code></pre>

<p><strong>carbon.conf</strong> includes the basic configuration for all Carbon daemons (Cache, Aggregator and Relay). Options like IP's and ports to bind and some other settings are located here.</p>

<pre class="highlight"><code class="language-sh"># cp $GRAPHITE/conf/storage-schemas.conf.example \
$GRAPHITE/conf/storage-schemas.conf</code></pre>

<p><strong>storage-schemas.conf</strong> includes configuration about the storage retention of metrics. More details about this will follow.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation9" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:9">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite Tags</h1>

<p>Since 1.1.x Graphite supports storing data using tags to identify each series. Those tag informations are stored in the tag database (TagDB). It is enabled by default and uses the Graphite-Web database backend, but it can also be configured to use an external Redis server or a custom plugin.</p>

<p>We disable tag support right now by changing <code>ENABLE_TAGS</code> to <code>False</code>.</p>

<p>File: <strong>/opt/graphite/conf/carbon.conf</strong></p>

<pre class="highlight"><code class="language-sh">ENABLE_TAGS = False</code></pre>

<p><strong>Note:</strong> When using tag support it is mandatory to set the correct <code>GRAPHITE_URL</code> for Graphite-Web. It is also recommended not to use the default SQLite backend of the Webapp.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Graphite Tag Support: <a href="http://graphite.readthedocs.io/en/latest/tags.html" target="_blank">http://graphite.readthedocs.io/en/latest/tags.html</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation10" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:10">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Cache Daemon</h1>

<p>It's time to start the Carbon Cache daemon for the first time:</p>

<pre class="highlight"><code class="language-sh"># $GRAPHITE/bin/carbon-cache.py status
carbon-cache (instance a) is not running

# $GRAPHITE/bin/carbon-cache.py start
Starting carbon-cache (instance a)

# $GRAPHITE/bin/carbon-cache.py status
carbon-cache (instance a) is running with pid 2344</code></pre>

<p><strong>Note:</strong> With this method Carbon Cache daemon will not be started after a reboot of the system.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation11" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:11">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Cache Service Unit</h1>

<p>File: <strong>/etc/systemd/system/carbon-cache-a.service</strong></p>

<pre class="highlight"><code class="language-sh">[Unit]
Description=Graphite Carbon Cache (instance a)
After=network.target

[Service]
Type=forking
StandardOutput=syslog
StandardError=syslog
ExecStart=/opt/graphite/bin/carbon-cache.py \
  --instance=a \
  --config=/opt/graphite/conf/carbon.conf \
  --pidfile=/var/run/carbon-cache-a.pid \
  --logdir=/var/log/carbon/ start
ExecReload=/bin/kill -USR1 $MAINPID
PIDFile=/var/run/carbon-cache-a.pid

[Install]
WantedBy=multi-user.target</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation12" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:12">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Start Carbon Cache Daemon</h1>

<p>Start Carbon Cache daemon with systemd:</p>

<pre class="highlight"><code class="language-sh"># $GRAPHITE/bin/carbon-cache.py stop

# systemctl daemon-reload
# systemctl start carbon-cache-a.service
# systemctl enable carbon-cache-a.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation13" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:13">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-Web Configuration</h1>

<p>Graphite-Web needs some more configuration. In addition to a working Apache 2 virtual host, the WSGI script and a basic configuration is required.</p>

<pre class="highlight"><code class="language-sh"># cp $GRAPHITE/examples/example-graphite-vhost.conf \
/etc/httpd/conf.d/graphite-web.conf

# cp $GRAPHITE/conf/graphite.wsgi.example \
$GRAPHITE/conf/graphite.wsgi</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation14" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:14">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-Web Configuration</h1>

<p><strong>local_settings.py</strong> includes all configuration for the webapp. Here you can enable a memcache daemon and configure multiple Carbon Cache backends. For now we only need to set a secret key which is needed for the database initialization and adjust the time zone.</p>

<pre class="highlight"><code class="language-sh"># cp $GRAPHITE/webapp/graphite/local_settings.py.example \
$GRAPHITE/webapp/graphite/local_settings.py</code></pre>

<p>File: <strong>/opt/graphite/webapp/graphite/local_settings.py</strong></p>

<pre class="highlight"><code class="language-sh">SECRET_KEY = 'random-string'

TIME_ZONE = 'Europe/Berlin'</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation15" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/05_installation:15">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-Web MySQL Database</h1>

<p>Graphite-Web will use a SQLite database per default, but it can be changed to PostgreSQL, MySQL or Oracle. Here's an example for MySQL:</p>

<pre class="highlight"><code class="language-sql">CREATE DATABASE graphite;

GRANT ALL PRIVILEGES ON graphite.* TO 'graphite'\
@'localhost' IDENTIFIED BY 'graphite';</code></pre>

<p>File: <strong>/opt/graphite/webapp/graphite/local_settings.py</strong></p>

<pre class="highlight"><code class="language-sh">DATABASES = {
    'default': {
        'NAME': 'graphite',
        'ENGINE': 'django.db.backends.mysql',
        'USER': 'graphite',
        'PASSWORD': 'graphite',
        'HOST': 'localhost',
        'PORT': '3306'
    }
}</code></pre>

<p><strong>Note:</strong> Package <code>MySQL-python</code> is already pre-installed on "graphing1.localdomain".</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation16" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:16">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-Web Database Initialization</h1>

<p>The database needs to be initialized:</p>

<pre class="highlight"><code class="language-sh"># PYTHONPATH=$GRAPHITE/webapp django-admin.py \
migrate --settings=graphite.settings --run-syncdb</code></pre>

<p>After the initialization we should create a user with admin rights. This user can later be used to login to Graphite-Web and store graphs and dashboards.</p>

<pre class="highlight"><code class="language-sh"># PYTHONPATH=$GRAPHITE/webapp django-admin.py \
createsuperuser --settings=graphite.settings

Username (leave blank to use 'root'):
Email address:
Password: ******
Password (again): ******
Superuser created successfully.</code></pre>

<p><strong>Note:</strong> The users' password can be changed with subcommand <code>changepassword</code>. </p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Show all Django subcommands:</p>

<pre class="highlight"><code class="language-sh"># PYTHONPATH=$GRAPHITE/webapp django-admin.py help \
--settings=graphite.settings</code></pre>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation17" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:17">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-Web Verification</h1>

<p>Django's command-line utility also provides subcommands to <code>check</code> and <code>test</code> the installed components:</p>

<pre class="highlight"><code class="language-sh"># PYTHONPATH=$GRAPHITE/webapp django-admin.py check \
--settings=graphite.settings

# PYTHONPATH=$GRAPHITE/webapp django-admin.py test \
--settings=graphite.settings</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation18" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:18">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-Web Permissions</h1>

<p>The SQLite database and the webapp logs are located in the storage directory, therefore we change the owner to <em>apache</em>:</p>

<pre class="highlight"><code class="language-sh"># chown apache:root $GRAPHITE/storage
# chown apache:apache $GRAPHITE/storage/graphite.db</code></pre>

<p>It's also important to change the permissions for the log directory, otherwise you will get the error <code>"populate() isn't reentrant"</code> later:</p>

<pre class="highlight"><code class="language-sh"># chown -Rf apache:root $GRAPHITE/storage/log</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation19" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:19">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Apache Configuration</h1>

<p>The default HTTP name for Graphite-Web is <code>graphite</code> and configured in <strong>graphite-web.conf</strong>. In order to access Graphite-Web we have to create the static files and allow web access to the directory:</p>

<pre class="highlight"><code class="language-sh"># PYTHONPATH=$GRAPHITE/webapp django-admin.py \
collectstatic --noinput --settings=graphite.settings</code></pre>

<p>File: <strong>/etc/httpd/conf.d/graphite-web.conf</strong></p>

<pre class="highlight"><code class="language-sh">&lt;Directory /opt/graphite/static&gt;
    Require all granted
&lt;/Directory&gt;</code></pre>

<p>Finally we can restart the pre-installed Apache webserver:</p>

<pre class="highlight"><code class="language-sh"># systemctl restart httpd.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation20" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:20">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Installation Verification</h1>

<p>To prove if everything worked open your browser with the default url of Graphite-Web: <a href="http://graphite" target="_blank">http://graphite</a></p>

<p>However it's <strong>always</strong> recommended to <strong>have a look at the logs</strong>!</p>

<ul>
<li>Graphite-Web: <strong>/opt/graphite/storage/log/webapp/</strong>
</li>
<li>Carbon Cache: <strong>/var/log/carbon/</strong>
</li>
<li>Apache: <strong>/var/log/httpd/</strong>
</li>
<li>Whisper Files: <strong>/opt/graphite/storage/whisper/</strong>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation21" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:21">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Alternative EPEL Package Installation (1/2)</h1>

<p>Graphite 0.9.16 on CentOS 7:</p>

<pre class="highlight"><code class="language-sh"># yum -y install python-carbon python-whisper
# yum -y install graphite-web

# systemctl enable carbon-cache.service --now</code></pre>

<p>File: <strong>/etc/graphite-web/local_settings.py</strong></p>

<pre class="highlight"><code class="language-sh">SECRET_KEY = 'random-string'

TIME_ZONE = 'Europe/Berlin'

# python /usr/lib/python2.7/site-packages/\
graphite/manage.py syncdb</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="05_installation" id="sections_graphite_05_installation22" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/05_installation:22">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Alternative EPEL Package Installation (2/2)</h1>

<p>File: <strong>/etc/httpd/conf.d/graphite-web.conf</strong></p>

<pre class="highlight"><code class="language-sh">&lt;Directory "/usr/share/graphite"&gt;
  &lt;IfModule mod_authz_core.c&gt;
    # Apache 2.4
    # Require local
    Require all granted
  &lt;/IfModule&gt;
  ...
&lt;/Directory&gt;

# chown apache:apache /var/lib/graphite-web/graphite.db 
# systemctl enable httpd.service --now</code></pre>

<p>Graphite-Web: <strong><a href="http://graphite-web" target="_blank">http://graphite-web</a></strong></p>

<p>Config Files: <strong>/etc/carbon/</strong> and <strong>/etc/graphite-web/</strong></p>

<p>Log Files: <strong>/var/log/carbon/</strong> and <strong>/var/log/httpd/</strong></p>

<p>Whisper Files: <strong>/var/lib/carbon/whisper/</strong></p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="06_flow" id="sections_graphite_06_flow1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/graphite/06_flow:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>3.5 Data Flow</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="06_flow" id="sections_graphite_06_flow2" class="slide small printonly" data-transition="none">
<div class="content small printonly" ref="sections/graphite/06_flow:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Receive Data</h1>

<p>To receive metrics, Graphite provides by default two interfaces. On Port 2003 Carbon  is listening with a plain text protocol, on port 2004 with the so-called "Pickle protocol".</p>

<p>While the plain text protocol is pretty simple "<strong>&lt;metric.path&gt;.&lt;value&gt;.&lt;timestamp&gt;</strong>", the Pickle protocol is more complex and looks more like a multidimensional array. The advantage of the plain text protocol is its simplicity, the Pickle protocol instead is more efficient. In addition, multiple metrics can be transferred in a bulk.</p>

<pre class="highlight"><code class="language-sh"># echo "localhost.tmp.files `ls /tmp | wc -l` `date +%s`"
localhost.tmp.files 9 1522237082

# echo "localhost.tmp.files `ls /tmp | wc -l` `date +%s`" \
| nc localhost 2003</code></pre>

<p>Tags must be appended to the metrics path with semicolon: "<strong>;&lt;tag-key&gt;=&lt;tag-value&gt;</strong>"</p>

<pre class="highlight"><code class="language-sh"># echo "localhost.tmp.files;os=linux;dist=centos \
`ls /tmp | wc -l` `date +%s`"
localhost.tmp.files;os=linux;dist=centos 9 1522237082</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="06_flow" id="sections_graphite_06_flow3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/graphite/06_flow:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Cache Datapoint Flow</h1>

<ul>
<li>Datapoint arrives at Carbon Cache</li>
<li>According to its metric a queue is created

<ul>
<li>If the queue already exists, datapoint is added to it</li>
<li>One queue represents one metric path, hence one Whisper file</li>
</ul>
</li>
<li>A writer thread periodically writes down all the datapoints

<ul>
<li>There are 4 different algorithms for writing down datapoints</li>
<li>All datapoints of one queue are written at once to the corresponding Whisper file: update_many()</li>
</ul>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="06_flow" id="sections_graphite_06_flow4" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/06_flow:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Cache Write Algorithms (1/2)</h1>

<p>The thread that writes metrics to disk can use on of the following strategies determining the order in which metrics are removed from cache and flushed to disk. This setting can be adjusted in <strong>carbon.conf</strong> with <code>CACHE_WRITE_STRATEGY</code> in the <code>[cache]</code> section.</p>

<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<strong>sorted</strong> (default)</td>
<td>All metrics in the cache will be counted and an ordered list of them will be sorted according to the number of datapoints in the cache at the moment of the list's creation. Metrics will then be flushed from the cache to disk in that order.</td>
</tr>
<tr>
<td><strong>timesorted</strong></td>
<td>All metrics in the list will be looked at and sorted according to the timestamp of there datapoints. The metric that were the least recently written will be written first. This is an hybrid strategy between max and sorted which is particularly adapted to sets of metrics with non-uniform resolutions.</td>
</tr>
<tr>
<td><strong>max</strong></td>
<td>The writer thread will always pop and flush the metric from cache that has the most datapoints. This will give a strong flush preference to frequently updated metrics and will also reduce random file-io. Infrequently updated metrics may only ever be persisted to disk at daemon shutdown if there are a large number of metrics which receive very frequent updates OR if disk i/o is very slow.</td>
</tr>
</tbody>
</table>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="06_flow" id="sections_graphite_06_flow5" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/06_flow:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Cache Write Algorithms (2/2)</h1>

<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>naive</strong></td>
<td>Metrics will be flushed from the cache to disk in an unordered fashion. This strategy may be desirable in situations where the storage for whisper files is solid state, CPU resources are very limited or deference to the OS's i/o scheduler is expected to compensate for the random write pattern.</td>
</tr>
</tbody>
</table>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="06_flow" id="sections_graphite_06_flow6" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/graphite/06_flow:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Internal Statistics (1/2)</h1>

<table>
<thead>
<tr>
<th>Metric</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>activeConnections</strong></td>
<td>Number of active connections. (&gt;=1.0.0)</td>
</tr>
<tr>
<td><strong>avgUpdateTime</strong></td>
<td>The average amount of time spent per Whisper update operation.</td>
</tr>
<tr>
<td><strong>blacklistMatches</strong></td>
<td>Number of blacklist matches.</td>
</tr>
<tr>
<td><strong>cache.bulk_queries</strong></td>
<td>Number of bulk queries to the carbon-cache instance.</td>
</tr>
<tr>
<td><strong>cache.overflow</strong></td>
<td>Number of datapoints received while the cache was full.</td>
</tr>
<tr>
<td><strong>cache.queries</strong></td>
<td>Number of all cache queries received by the cache from the webapp.</td>
</tr>
<tr>
<td><strong>cache.queues</strong></td>
<td>Number of metric keys (metric name) in the cache at the time of recording.</td>
</tr>
<tr>
<td><strong>cache.size</strong></td>
<td>Number of metric datapoints in the cache at the time of recording.</td>
</tr>
<tr>
<td><strong>committedPoints</strong></td>
<td>Number of metric datapoints flushed to disk.</td>
</tr>
<tr>
<td><strong>cpuUsage</strong></td>
<td>CPU usage of the carbon-cache instance.</td>
</tr>
<tr>
<td><strong>creates</strong></td>
<td>Number of Whisper files successfully created.</td>
</tr>
</tbody>
</table>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="06_flow" id="sections_graphite_06_flow7" class="slide smbullets small" data-transition="none">
<div class="content smbullets small" ref="sections/graphite/06_flow:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Internal Statistics (2/2)</h1>

<table>
<thead>
<tr>
<th>Metric</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>droppedCreates</strong></td>
<td>Number of failed Whisper create operations. (&gt;=1.0.0)</td>
</tr>
<tr>
<td><strong>errors</strong></td>
<td>Number of failed Whisper update operations.</td>
</tr>
<tr>
<td><strong>memUsage</strong></td>
<td>Memory usage of the carbon-cache daemon.</td>
</tr>
<tr>
<td><strong>metricsReceived</strong></td>
<td>Number of datapoints received by the carbon-cache listener.</td>
</tr>
<tr>
<td><strong>pointsPerUpdate</strong></td>
<td>Average number of datapoints written per Whisper update operation. The higher the value, the more effective the cache is performing at batch writes (fewer I/O operations).</td>
</tr>
<tr>
<td><strong>updateOperations</strong></td>
<td>Number of successful Whisper update operations.</td>
</tr>
<tr>
<td><strong>whitelistRejects</strong></td>
<td>Number of whitelist rejects.</td>
</tr>
</tbody>
</table>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/graphite/07_storage:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>3.6 Data Storage</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/graphite/07_storage:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Whisper</h1>

<ul>
<li>File based time-series database</li>
<li>Fixed size (like RRD)</li>
<li>Values paired with timestamps</li>
<li>Rollup aggregation</li>
<li>Multiple archives</li>
</ul>

<p>Carbon Cache uses Whisper to store the received datapoints. Each datapoint gets paired with its linked timestamp. Data can be stored into multiple archives, where one archive describes the precision and retention of this data.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage3" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/graphite/07_storage:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Whisper - Anatomy</h1>

<p></p>
<center><img src="./file//sections/graphite/_images/graphite-whisper.png" style="width:95%"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage4" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/07_storage:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Whisper vs. RRD</h1>

<p>In a different way from RRD, Whisper supports updates to time slots with timestamps prior to its most recent one. This means that there is no way with RRD to back-fill data properly.</p>

<p>Whisper is slower than RRD, but fast enough for most purposes. This is the consequence of Whisper being written in Python, where RRD is written in C. The performance is in theory, depending on the operation, 2 to 5 times slower. </p>

<p>In practice the difference is measured in hundreds of microseconds which leads to less than a millisecond difference for most operations. Anyway, storing time-series data always causes high I/O on your disk. Using Carbon Relay you can distribute this load to multiple servers.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage5" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/07_storage:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Metric Path</h1>

<p>The metric path determines the hierarchy in which data is being held and can be seen as an address of your data. Each element of the metric path describes also a directory on the filesystem where Whisper files are stored. The last element is the filename.</p>

<pre class="highlight"><code class="language-sh">berlin.dc1.r12.server1.load.longterm
 berlin
  dc1
      r12
          server1
             load
                 longterm.wsp
                 midterm.wsp
                 shortterm.wsp
            server2</code></pre>

<p>With Graphite-Web metrics can be accessed by using globs (wildcards or character lists) in the metric path. Graphite-Web will then return the datapoints of all matching metrics.</p>

<pre class="highlight"><code class="language-sh">berlin.*.r12.server1.load.longterm
berlin.dc1.r12.server{1,2,3}.load.longterm</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage6" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/graphite/07_storage:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Storage Schema</h1>

<p><strong>storage-schemas.conf</strong> stores the configuration about retention and frequency in which datapoints should be stored. The config file includes multiple sections which are applied from the top to the bottom. Based on patterns it matches metric paths and tells Whisper how to store the data. The first pattern that matches is being applied for the metric path, other sections are ignored.</p>

<ul>
<li>Config file is read every 60 seconds, no need for reload</li>
<li>Patterns are regex</li>
<li>First pattern that matches is used</li>
<li>Patterns from top to bottom</li>
<li>Whisper file is created on first metric received</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage7" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/07_storage:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Storage Schema Configuration</h1>

<p>Each section has 3 lines:</p>

<ul>
<li>name</li>
<li>pattern</li>
<li>frequency/retention (multiple)</li>
</ul>

<p>Example storage schemas:</p>

<pre class="highlight"><code class="language-sh">[carbon]
pattern = ^carbon\.
retentions = 60:90d

[default]
pattern = .*
retentions = 1s:30m,1m:1d,5m:7d</code></pre>

<p>By aggregating data you can save I/O on your disks. Already created Whisper files will not be affected by configuration changes!</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage8" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/07_storage:8">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Storage Aggregation</h1>

<p>When downsampling data Whisper will do an average over a set of datapoints. This behaviour can be changed in <strong>storage-aggregation.conf</strong>. Like in other configuration files the entries are scanned from top to the bottom and the first match applies to the Whisper files.</p>

<ul>
<li>Pattern

<ul>
<li>Regex pattern to match metric paths</li>
</ul>
</li>
<li>xFilesFactor

<ul>
<li>Ratio of datapoints that are required to do an aggregation to the next archive (float between 0 and 1)</li>
</ul>
</li>
<li>aggregationMethod

<ul>
<li>average, sum, min, max, or last</li>
</ul>
</li>
</ul>

<p>Default aggregation entry:</p>

<pre class="highlight"><code class="language-sh">[default_average]
pattern = .*
xFilesFactor = 0.5 # 50 percent
aggregationMethod = average</code></pre>

<p>This configuration doesn't affect the first archive and already created Whisper files will not be affected by configuration changes!</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage9" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/07_storage:9">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Whisper File Size</h1>

<p>Example storage schema:</p>

<pre class="highlight"><code class="language-sh">1s:30m,1m:1d,5m:7d</code></pre>

<p>Convert into seconds:</p>

<pre class="highlight"><code class="language-sh">1s:30m=1s:(30*60)=1s:1800s
1m:1d=60s:(24*60*60)=60s:86400s
5m:7d=(5*60):(7*24*60*60)=300s:604800s</code></pre>

<p>12 bytes for each datapoint and 12 bytes of archive information for every retention period:</p>

<pre class="highlight"><code class="language-sh">1800s/1s*12b+12b=21612b
86400s/60s*12b+12b=17292b
604800s/300s*12b+12b=24204b

21612b+17292b+24204b=63108b</code></pre>

<p>16 bytes of database metadata:</p>

<pre class="highlight"><code class="language-sh">63108b+16b=63124b/1024=61.64kb</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage10" class="slide" data-transition="none">
<div class="content " ref="sections/graphite/07_storage:10">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Whisper File Size Calculator</h1>

<p>Online calculator: <a href="http://m30m.github.io/whisper-calculator/" target="_blank">http://m30m.github.io/whisper-calculator/</a></p>

<p></p>
<center><img src="./file//sections/graphite/_images/whisper-file-size-calculator.png" style="width:70%"></center>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>There's also a script for the calculation of the Whisper file size available: <a href="https://gist.github.com/jjmaestro/5774063" target="_blank">https://gist.github.com/jjmaestro/5774063</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage11" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/07_storage:11">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Whisper Tools (1/2)</h1>

<p>Whisper comes with some default tools. With those it is possible to create, edit and view Whisper files.</p>

<table>
<thead>
<tr>
<th>Tool</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>rrd2whisper.py</strong></td>
<td>Convert a rrd file into a whisper (.wsp) file</td>
</tr>
<tr>
<td><strong>whisper-auto-resize.py</strong></td>
<td>Resize archives with default settings (&gt;=1.0.0)</td>
</tr>
<tr>
<td><strong>whisper-auto-update.py</strong></td>
<td>Update values (&gt;=1.0.0)</td>
</tr>
<tr>
<td><strong>whisper-create.py</strong></td>
<td>Create a new Whisper file</td>
</tr>
<tr>
<td><strong>whisper-diff.py</strong></td>
<td>Differences beetwen two Whisper files</td>
</tr>
<tr>
<td><strong>whisper-dump.py</strong></td>
<td>Dump raw Whisper data</td>
</tr>
<tr>
<td><strong>whisper-fetch.py</strong></td>
<td>Dump readable (timestamp + value) data from Whisper files</td>
</tr>
<tr>
<td><strong>whisper-fill.py</strong></td>
<td>Backfill datapoints from one whisper file into another</td>
</tr>
</tbody>
</table>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage12" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/07_storage:12">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Whisper Tools (2/2)</h1>

<table>
<thead>
<tr>
<th>Tool</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>whisper-info.py</strong></td>
<td>Get metadata</td>
</tr>
<tr>
<td><strong>whisper-merge.py</strong></td>
<td>Merge two Whisper files</td>
</tr>
<tr>
<td><strong>whisper-resize.py</strong></td>
<td>Resize archives with individual settings</td>
</tr>
<tr>
<td><strong>whisper-set-aggregation-method.py</strong></td>
<td>Change aggregation method</td>
</tr>
<tr>
<td><strong>whisper-set-xfilesfactor.py</strong></td>
<td>Change xFilesFactor (&gt;=1.0.0)</td>
</tr>
<tr>
<td><strong>whisper-update.py</strong></td>
<td>Update value</td>
</tr>
</tbody>
</table>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage13" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/07_storage:13">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Common Whisper Tools Usage (1/2)</h1>

<pre class="highlight"><code class="language-sh"># whisper-fetch.py --pretty metricsReceived.wsp
...
Fri Jun  2 08:53:00 2017    976.000000
Fri Jun  2 08:54:00 2017    1001.000000
Fri Jun  2 08:55:00 2017    1011.000000

# whisper-info.py metricsReceived.wsp 
maxRetention: 7776000
xFilesFactor: 0.5
aggregationMethod: average
fileSize: 1555228

Archive 0
retention: 7776000
secondsPerPoint: 60
points: 129600
size: 1555200
offset: 28</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage14" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/07_storage:14">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Common Whisper Tools Usage (2/2)</h1>

<pre class="highlight"><code class="language-sh"># whisper-resize.py --nobackup metricsReceived.wsp 60:120d
Retrieving all data from the archives
Creating new whisper database: metricsReceived.wsp.tmp
Created: metricsReceived.wsp.tmp (1555228 bytes)
Migrating data without aggregation...
Renaming old database to: metricsReceived.wsp.bak
Renaming new database to: metricsReceived.wsp

# whisper-create test.wsp 1s:30m 1m:1d 5m:7d
Created: test.wsp (63124 bytes)</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="07_storage" id="sections_graphite_07_storage15" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/07_storage:15">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>White- and Blacklisting</h1>

<p>When this feature is enabled, each Carbon daemon will only accept metrics that are whitelisted and reject those which are blacklisted. </p>

<p>Each file, <strong>whitelist.conf</strong> and <strong>blacklist.conf</strong> takes one regular expression per line. If <strong>whitelist.conf</strong> does not exist, everything is whitelisted by default. Configuration is reloaded automatically, no restart of the daemon is necessary.</p>

<p>To enable the functionality, edit <strong>carbon.conf</strong>:</p>

<pre class="highlight"><code class="language-sh">USE_WHITELIST = True</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="08_advanced-components" id="sections_graphite_08_advanced-components1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/graphite/08_advanced-components:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>3.7 Advanced Components</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="08_advanced-components" id="sections_graphite_08_advanced-components2" class="slide smbullets printonly" data-transition="none">
<div class="content smbullets printonly" ref="sections/graphite/08_advanced-components:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Relay</h1>

<ul>
<li>Forward incoming metrics to another Carbon daemon</li>
<li>Replicate metrics to one or more destinations</li>
<li>Sharding</li>
<li>Forward based on consistent hash (default) or</li>
<li>Rule based routing</li>
</ul>

<p>Carbon Relay is a kind of "loadbalancer" for Carbon Cache and/or Aggregator. It can forward metrics based on consistent hashes or with defined regex rules.</p>

<p></p>
<center><img src="./file//sections/graphite/_images/graphite-cache-aggregator-relay.png" style="width:460px"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="08_advanced-components" id="sections_graphite_08_advanced-components3" class="slide smbullets printonly" data-transition="none">
<div class="content smbullets printonly" ref="sections/graphite/08_advanced-components:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Aggregator</h1>

<ul>
<li>In front of Carbon Cache</li>
<li>Buffers metrics</li>
<li>Aggregation of metrics by rules</li>
<li>Reduce I/O by aggregating data</li>
</ul>

<p>Carbon Aggregator sits in front of Carbon Cache and receives metrics. The function of this daemon is to aggregate the data it receives and forwards it to Carbon Cache for permanent storage. For instance it can sum statistics of multiple servers into one metric.</p>

<p></p>
<center><img src="./file//sections/graphite/_images/graphite-cache-aggregator.png" style="width:460px"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/graphite/09_full-single-node-setup:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>3.8 Full Single-Node Setup</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup2" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/graphite/09_full-single-node-setup:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Full Single-Node Setup</h1>

<p></p>
<center><img src="./file//sections/graphite/_images/graphite-full-single-node.png" style="width:206px;height:519px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup3" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/09_full-single-node-setup:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Daemon Configuration</h1>

<p>All Carbon daemons are configured in <strong>carbon.conf</strong> where each daemon gets its own section.</p>

<p>File: <strong>/opt/graphite/conf/carbon.conf</strong></p>

<pre class="highlight"><code class="language-sh">[cache]
LINE_RECEIVER_PORT = 2023         # default: 2003
PICKLE_RECEIVER_PORT = 2024       # default: 2004
CACHE_QUERY_PORT = 7002

[relay]
LINE_RECEIVER_PORT = 2003         # default: 2013
PICKLE_RECEIVER_PORT = 2004       # default: 2014

RELAY_METHOD = consistent-hashing # default: rules
DESTINATIONS = 127.0.0.1:2014     # default: :2004

[aggregator]
LINE_RECEIVER_PORT = 2013         # default: 2023
PICKLE_RECEIVER_PORT = 2014       # default: 2024

DESTINATIONS = 127.0.0.1:2024     # default: :2004</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup4" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/09_full-single-node-setup:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Relay Configuration</h1>

<p>Take care of <strong>relay-rules.conf</strong>:</p>

<pre class="highlight"><code class="language-sh"># cp $GRAPHITE/conf/relay-rules.conf.example \
$GRAPHITE/conf/relay-rules.conf</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup5" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/09_full-single-node-setup:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Relay Methods</h1>

<p>The <code>RELAY_METHOD</code> defines how metrics are distributed: </p>

<ul>
<li>
<code>consistent-hashing</code>

<ul>
<li>Even distribution of metrics between destinations</li>
</ul>
</li>
<li>
<code>aggregated-consistent-hashing</code>

<ul>
<li>Send to a group of Carbon Aggregators</li>
</ul>
</li>
<li>
<code>rules</code>

<ul>
<li>Route metrics to destinations based on pattern rules</li>
<li>Requires <strong>relay-rules.conf</strong>
</li>
</ul>
</li>
</ul>

<p>Example rule in <strong>/opt/graphite/conf/relay-rules.conf</strong> with <code>rules</code> RELAY_METHOD:</p>

<pre class="highlight"><code class="language-sh">[collectd_dc1]
pattern = ^collectd\.dc1\.
destinations = 127.0.0.1:2104:a

[collectd_dc2]
pattern = ^collectd\.dc2\.
destinations = 127.0.0.1:2204:b</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup6" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/09_full-single-node-setup:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Relay Service Unit</h1>

<p>File: <strong>/etc/systemd/system/carbon-relay.service</strong></p>

<pre class="highlight"><code class="language-sh">[Unit]
Description=Graphite Carbon Relay
After=network.target

[Service]
Type=forking
StandardOutput=syslog
StandardError=syslog
ExecStart=/opt/graphite/bin/carbon-relay.py \
  --instance=a \
  --config=/opt/graphite/conf/carbon.conf \
  --pidfile=/var/run/carbon-relay.pid \
  --logdir=/var/log/carbon/ start
ExecReload=/bin/kill -USR1 $MAINPID
PIDFile=/var/run/carbon-relay.pid

[Install]
WantedBy=multi-user.target</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup7" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/09_full-single-node-setup:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Start Carbon Relay Daemon</h1>

<p>Start Carbon Relay daemon with systemd:</p>

<pre class="highlight"><code class="language-sh"># systemctl restart carbon-cache-a.service

# systemctl daemon-reload
# systemctl start carbon-relay.service
# systemctl enable carbon-relay.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup8" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/09_full-single-node-setup:8">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Aggregator Configuration</h1>

<p>Take care of <strong>aggregation-rules.conf</strong>:</p>

<pre class="highlight"><code class="language-sh"># cp $GRAPHITE/conf/aggregation-rules.conf.example \
$GRAPHITE/conf/aggregation-rules.conf</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup9" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/09_full-single-node-setup:9">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Aggregation Rules</h1>

<p>When using Carbon Aggregator, the most important configuration is made in <strong>aggregation-rules.conf</strong>. The file accepts input patterns for metrics and is able to merge multiple incoming metrics to one final metric which is then written as single Whisper file.</p>

<p>Each line of the configuration should look like this:</p>

<pre class="highlight"><code class="language-sh">output_template (frequency) = method input_pattern</code></pre>

<p>This will capture any metric that matches <code>input_pattern</code>. Every <code>frequency</code> seconds it will calculate the destination metric using the specified <code>method</code> which can be <code>sum</code> or <code>avg</code>. The config also accepts placeholders.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup10" class="slide small smbullets" data-transition="none">
<div class="content small smbullets" ref="sections/graphite/09_full-single-node-setup:10">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Aggregation Rules Example</h1>

<p>Here is an example of an Apache environment. Goal is to track requests from all application servers and store the sum in a single metric:</p>

<pre class="highlight"><code class="language-sh">&lt;env&gt;.applications.&lt;app&gt;.all.requests (60) 
  = sum &lt;env&gt;.applications.&lt;app&gt;.*.requests</code></pre>

<p>The result is, that metrics matching the pattern will get summed each 60 seconds and written to one single destination:</p>

<pre class="highlight"><code class="language-sh"># input
prod.applications.apache.www01.requests
prod.applications.apache.www02.requests
prod.applications.apache.www03.requests

# output
prod.applications.apache.all.requests</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup11" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/09_full-single-node-setup:11">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Aggregator Service Unit</h1>

<p>File: <strong>/etc/systemd/system/carbon-aggregator.service</strong></p>

<pre class="highlight"><code class="language-sh">[Unit]
Description=Graphite Carbon Aggregator
After=network.target

[Service]
Type=forking
StandardOutput=syslog
StandardError=syslog
ExecStart=/opt/graphite/bin/carbon-aggregator.py \
  --instance=a \
  --config=/opt/graphite/conf/carbon.conf \
  --pidfile=/var/run/carbon-aggregator.pid \
  --logdir=/var/log/carbon/ start
ExecReload=/bin/kill -USR1 $MAINPID
PIDFile=/var/run/carbon-aggregator.pid

[Install]
WantedBy=multi-user.target</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup12" class="slide small" data-transition="none">
<div class="content small" ref="sections/graphite/09_full-single-node-setup:12">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Start Carbon Aggregator Daemon</h1>

<p>Start Carbon Aggregator daemon with systemd:</p>

<pre class="highlight"><code class="language-sh"># systemctl daemon-reload
# systemctl start carbon-aggregator.service
# systemctl enable carbon-aggregator.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/graphite/" data-title="09_full-single-node-setup" id="sections_graphite_09_full-single-node-setup13" class="slide small smbullets" data-transition="none">
<div class="content small smbullets" ref="sections/graphite/09_full-single-node-setup:13">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Rewrite Rules</h1>

<p>With rewrite rules, metric paths can be rewritten before Whisper files are created. This is handy when your collector sends metric paths which are not accurate. The configuration for rewrite rules takes place in <strong>rewrite-rules.conf</strong>. This functionality is currently only available for Carbon Aggregator.</p>

<p>A rewrite rule should look like as follows:</p>

<pre class="highlight"><code class="language-sh">regex-pattern = replacement-text</code></pre>

<p>These are some rewrite rules commonly used when collectd sends metrics:</p>

<pre class="highlight"><code class="language-sh">[pre]
\.load\.load\. = .load.
\.memory\.memory\. = .memory.
\.mysql\.stats\. = .mysql.
_TCP80 = .TCP80</code></pre>

<p>Rewrite rules consist of two sections <code>[pre]</code> and <code>[post]</code>. Rules in the pre section are applied before aggregation and rules in the post section after aggregation takes place.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/collectd/" data-title="00_title" id="sections_collectd_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/collectd/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ collectd</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>4 collectd</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/collectd/" data-title="01_collectd" id="sections_collectd_01_collectd1" class="slide" data-transition="none">
<div class="content " ref="sections/collectd/01_collectd:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ collectd</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>collectd</h1>

<ul>
<li>Collects data</li>
<li>Variety of ways to store data

<ul>
<li>RRD</li>
<li>OpenTSDB</li>
<li>HTTP</li>
<li>Redis</li>
<li>Graphite (InfluxDB)</li>
<li>...</li>
</ul>
</li>
<li>Wide choice of plugins

<ul>
<li>CPU, Memory, Load, Network, ...</li>
<li>MySQL, PostgreSQL, Apache, Bind, ...</li>
<li>cURL, Exec, Perl, Python, Java, ...</li>
</ul>
</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://collectd.org" target="_blank">https://collectd.org</a><br>
Docs: <a href="https://collectd.org/documentation.shtml" target="_blank">https://collectd.org/documentation.shtml</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/collectd/" data-title="01_collectd" id="sections_collectd_01_collectd2" class="slide small" data-transition="none">
<div class="content small" ref="sections/collectd/01_collectd:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ collectd</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>collectd</h1>

<p>collectd is a daemon that runs on your server and collects periodically performance data about several parts of the system. One of many plugins is "write_graphite" which lets you send those collected data to a Graphite server. </p>

<p>collectd provides a lot of plugins by default. Each plugin serves a specific set of data and mostly can be configured to fit your needs. Some plugins differ from others, for example there are plugins which are just for forwarding the statistics to receivers like Graphite. There are also plugins which enable you to write your own plugins in languages like Perl, Python or Java.</p>

<p>With the included SNMP support collectd stays not limited to the host it's running. You can get performance counters of the network activity from switches, routers or other devices that are capable of SNMP.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Website: <a href="https://collectd.org" target="_blank">https://collectd.org</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/collectd/" data-title="01_collectd" id="sections_collectd_01_collectd3" class="slide small" data-transition="none">
<div class="content small" ref="sections/collectd/01_collectd:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ collectd</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>collectd Installation</h1>

<p>collectd can be installed via packages. You should take care that you install a version &gt;= 5.0, because the Graphite plugin in earlier versions had to be configured in a different way than it is described here.</p>

<pre class="highlight"><code class="language-sh"># yum -y install collectd</code></pre>

<p>After the installation you should edit <strong>/etc/collectd.conf</strong>. It should include the following content:</p>

<pre class="highlight"><code class="language-sh">Hostname            "graphing1" # default: FQDN
FQDNLookup          false       # default: true
Interval            10
MaxReadInterval     86400
Timeout             2
ReadThreads         5
WriteThreads        5
Include             "/etc/collectd.d"</code></pre>

<p>Start collectd with systemd:</p>

<pre class="highlight"><code class="language-sh"># systemctl enable collectd.service --now</code></pre>

<p><strong>Note:</strong> collectd is already pre-installed on "graphing1.localdomain".</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/collectd/" data-title="01_collectd" id="sections_collectd_01_collectd4" class="slide" data-transition="none">
<div class="content " ref="sections/collectd/01_collectd:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ collectd</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>collectd Plugins</h1>

<p>Plugins are enabled with the phrase <code>LoadPlugin &lt;plugin&gt;</code>. You can find a list of all collectd plugins here: <a href="https://collectd.org/wiki/index.php/Table_of_Plugins" target="_blank">https://collectd.org/wiki/index.php/Table_of_Plugins</a>. 
This page also includes the documentation of each plugin.</p>

<p>By creating config files inside <strong>/etc/colletcd.d/</strong> the configuration of plugins will be way more tidy than configuring them all in one single file.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/collectd/" data-title="01_collectd" id="sections_collectd_01_collectd5" class="slide" data-transition="none">
<div class="content " ref="sections/collectd/01_collectd:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ collectd</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>collectd DF Plugin</h1>

<p>This example shows the content of the "DF" plugin, all other plugins are configured in the same manner.</p>

<p>File: <strong>/etc/collectd.d/df.conf</strong></p>

<pre class="highlight"><code class="language-sh">LoadPlugin df

&lt;Plugin df&gt;
  FSType "rootfs"
  FSType "xfs"
  IgnoreSelected false
  ReportByDevice false
  ReportInodes true
  ValuesAbsolute true
  ValuesPercentage false
&lt;/Plugin&gt;</code></pre>

<p>The configuration of plugins is in many cases optional. In some cases it's sufficient to just load the plugin without any configuration. Examples for this are "CPU", "Load" or "Memory".</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/collectd/" data-title="01_collectd" id="sections_collectd_01_collectd6" class="slide small" data-transition="none">
<div class="content small" ref="sections/collectd/01_collectd:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ collectd</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Storage Schema for collectd</h1>

<p>To store the data correctly, you need to configure a proper Carbon storage schema for data coming from collectd. The frequency which is configured here must be the same as configured in <strong>collectd.conf</strong>.</p>

<p>File: <strong>/opt/graphite/conf/storage-schemas.conf</strong></p>

<pre class="highlight"><code class="language-sh">[...]

[collectd]
pattern = ^collectd\.
retentions = 10s:5d

[...]</code></pre>

<p>When <code>LOG_CREATES</code> in <strong>carbon.conf</strong> is set to <code>True</code>, you can follow the logging of Carbon Cache in <strong>/var/log/carbon/creates.log</strong> to track if your Whisper files are being generated with the correct storage schema.</p>

<pre class="highlight"><code class="language-sh">new metric collectd.graphing1.interface-enp0s3.\
  if_dropped.tx matched schema collectd
new metric collectd.graphing1.interface-enp0s3.\
  if_dropped.tx matched schema default</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/collectd/" data-title="01_collectd" id="sections_collectd_01_collectd7" class="slide small" data-transition="none">
<div class="content small" ref="sections/collectd/01_collectd:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ collectd</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>collectd Graphite Plugin</h1>

<p>Sending the collected data to Graphite is not more than enabling and configuring the appropriate plugin.</p>

<p>File: <strong>/etc/collectd.d/write_graphite.conf</strong></p>

<pre class="highlight"><code class="language-sh">LoadPlugin write_graphite

&lt;Plugin write_graphite&gt;
  &lt;Node "graphing1"&gt;
    Host "localhost"
    Port "2003"
    Protocol "tcp"
    ReconnectInterval 0
    LogSendErrors true
    Prefix "collectd."
    Postfix ""
    StoreRates true
    AlwaysAppendDS false
    EscapeCharacter "_"
    SeparateInstances false
    PreserveSeparator false
    DropDuplicateFields false
  &lt;/Node&gt;
&lt;/Plugin&gt;</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/collectd/" data-title="01_collectd" id="sections_collectd_01_collectd8" class="slide small" data-transition="none">
<div class="content small" ref="sections/collectd/01_collectd:8">
<h1 class="section_title">~~~SECTION:MAJOR~~~ collectd</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Restart collectd Daemon</h1>

<p>After configuration changes collectd needs to be restarted:</p>

<pre class="highlight"><code class="language-sh"># systemctl restart collectd.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/webapp/" data-title="00_title" id="sections_webapp_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/webapp/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Webapp</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>5 Webapp</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/webapp/" data-title="01_web" id="sections_webapp_01_web1" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/webapp/01_web:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Webapp</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-Web</h1>

<p></p>
<center><img src="./file//sections/webapp/_images/graphite-web.png" style="width:460px;height:243px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/webapp/" data-title="01_web" id="sections_webapp_01_web2" class="slide small smbullets" data-transition="none">
<div class="content small smbullets" ref="sections/webapp/01_web:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Webapp</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-Web</h1>

<p>Graphite-Web is the visualization component of the Graphite stack. It consists mainly of 3 parts:</p>

<p><strong>Composer</strong></p>

<p>The composer is the first thing you see when opening Graphites web application. It enables you to browse through your metrics and display those. Multiple graph options can change the look and feel of graphs. For permanent usage templates can be stored (<strong>graphTemplates.conf</strong>) and applied to graphs. With plenty of functions you can combine, transform, calculate or filter datapoints. This functionality, which is also available for the API, makes Graphite-Web to one of the most powerful webinterfaces for graph visualization.</p>

<p><strong>Dashboard</strong></p>

<p>The dashboard brings the same functionality as the composer, but combines multiple graphs to one overview. When logged in, users can save dashboards for later usage. The behaviour of the dashboard can be adjusted in <strong>dashboard.conf</strong>.</p>

<p><strong>API</strong></p>

<p>Using the API you can retrieve data in different formats. This can be used for integration into third party tools or monitoring purposes. The API represents almost the same functionality as the composer.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/webapp/" data-title="01_web" id="sections_webapp_01_web3" class="slide small smbullets" data-transition="none">
<div class="content small smbullets" ref="sections/webapp/01_web:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Webapp</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Indexing</h1>

<p>For faster access to metrics Graphite supports an index. This index is actually just a text file that includes all available metrics. It can be generated by a cronjob periodically.</p>

<p>Content of <strong>/opt/graphite/storage/index</strong>:</p>

<pre class="highlight"><code class="language-sh">...
collectd.graphing1.cpu-0.cpu-wait
collectd.graphing1.cpu-0.cpu-user
collectd.graphing1.interface-lo.if_packets.rx
collectd.graphing1.interface-lo.if_packets.tx
collectd.graphing1.interface-lo.if_octets.tx
collectd.graphing1.interface-lo.if_octets.rx
...</code></pre>

<p>An optional cronjob that creates the index each hour may look like this:</p>

<pre class="highlight"><code class="language-sh">0 * * * * /opt/graphite/bin/build-index.sh &gt; /dev/null</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/webapp/" data-title="02_api" id="sections_webapp_02_api1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/webapp/02_api:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Webapp</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>5.1 Graphite-Web API</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/webapp/" data-title="02_api" id="sections_webapp_02_api2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/webapp/02_api:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Webapp</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>HTTP API</h1>

<p>The interactive webinterface of Graphite-Web is called Composer. Aside to this Graphite-Web also has a HTTP API which consists of two parts:</p>

<ul>
<li>Render API</li>
<li>Metrics API</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/webapp/" data-title="02_api" id="sections_webapp_02_api3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/webapp/02_api:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Webapp</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Render API</h1>

<p>The Render API can be used to retrieve and visualize datapoints. The API can be used to embed graphs in own applications or webinterfaces. Mostly the API is used by 3rd party dashboard tools like Grafana.</p>

<ul>
<li>Different formats:

<ul>
<li>png, raw, csv, json, svg, pdf, dygraph, rickshaw and pickle</li>
</ul>
</li>
<li>Paths with Wildcards</li>
<li>Relative or absolute time periods</li>
<li>Template function with variables</li>
<li>Almost full functionality of Composer</li>
</ul>

<p>Parameters: <a href="http://graphite.readthedocs.org/en/latest/render_api.html#graph-parameters" target="_blank">http://graphite.readthedocs.org/en/latest/render_api.html#graph-parameters</a></p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/webapp/" data-title="02_api" id="sections_webapp_02_api4" class="slide small" data-transition="none">
<div class="content small" ref="sections/webapp/02_api:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Webapp</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Render API - Sample 1</h1>

<p>Create a simple graph of the load of one of your servers in the last hour. Output as PNG with the resolution of 800x600.</p>

<pre class="highlight"><code class="language-sh">http://graphite/render
?target=collectd.graphing1.load.load.*
&amp;from=-1h
&amp;width=800
&amp;height=600</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/webapp/" data-title="02_api" id="sections_webapp_02_api5" class="slide small" data-transition="none">
<div class="content small" ref="sections/webapp/02_api:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Webapp</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Render API - Sample 2</h1>

<p>Create a JSON output of the free diskspace from one of your servers. Output only the last 5 minutes.</p>

<pre class="highlight"><code class="language-sh">http://graphite/render
?target=collectd.graphing1.df-root.df_complex-free
&amp;from=-5min
&amp;format=json</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/webapp/" data-title="02_api" id="sections_webapp_02_api6" class="slide small" data-transition="none">
<div class="content small" ref="sections/webapp/02_api:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Webapp</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Render API - Sample 3</h1>

<p>Build an average of the CPUs system time from two of your servers. Add a title to the graph and change the background color. Set a minimum of 0 and create an alias for the legend called "CPU system".</p>

<pre class="highlight"><code class="language-sh">http://graphite/render
?target=
  alias
    (
      averageSeries
      (
        collectd.graphing[1-2].cpu-*.cpu-system
      ), 
    "CPU system"
    )
&amp;title=CPU of all servers
&amp;bgcolor=red
&amp;yMin=0</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/webapp/" data-title="02_api" id="sections_webapp_02_api7" class="slide" data-transition="none">
<div class="content " ref="sections/webapp/02_api:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Webapp</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Metrics API</h1>

<p>Graphite-Web supports some functionality to browse through metrics.</p>

<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>/metrics/index.json</td>
<td>Walks the metrics tree and returns every metric found as a sorted JSON array.</td>
</tr>
<tr>
<td>/metrics/find?query=a.b.c.d</td>
<td>Finds metrics under a given path.</td>
</tr>
<tr>
<td>/metrics/expand?query=a.b.c.d</td>
<td>Expands the given query with matching paths.</td>
</tr>
</tbody>
</table>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Metrics API: <a href="http://graphite-api.readthedocs.io/en/latest/api.html#the-metrics-api" target="_blank">http://graphite-api.readthedocs.io/en/latest/api.html#the-metrics-api</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/grafana/" data-title="00_title" id="sections_grafana_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/grafana/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Grafana</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>6 Grafana</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/grafana/" data-title="01_grafana" id="sections_grafana_01_grafana1" class="slide" data-transition="none">
<div class="content " ref="sections/grafana/01_grafana:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Grafana</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Overview of Grafana</h1>

<p>Grafana is an Open Source webinterface that lets you visualize data from a lot of different data sources. Currently offical supported data sources are Graphite, Elasticsearch, CloudWatch, InfluxDB, OpenTSDB, Prometheus, MySQL and Postgres.</p>

<p>Since version 2.0 Grafana ships with its own backend server and since 3.0 additional data sources can be installed as plugins and mixed in the same chart. A core feature introduced with Grafana 4.0 was alerting.</p>

<ul>
<li>Visualize graphs</li>
<li>Create dashboards</li>
<li>Share</li>
<li>Annotations</li>
<li>Templates</li>
<li>Multiple backends</li>
<li>Alerts</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="http://grafana.org" target="_blank">http://grafana.org</a><br>
Docs: <a href="http://docs.grafana.org" target="_blank">http://docs.grafana.org</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/grafana/" data-title="01_grafana" id="sections_grafana_01_grafana2" class="slide" data-transition="none">
<div class="content " ref="sections/grafana/01_grafana:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Grafana</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Grafana 5</h1>

<p>Grafana v5.0 was released on March 1st 2018 and includes a lot of new features:</p>

<ul>
<li>New dashboard layout engine</li>
<li>UI improvements in look and function</li>
<li>New light theme</li>
<li>Dashboard folders</li>
<li>Permissions</li>
<li>Group users into teams and use them for permissions</li>
<li>Setup data sources and dashboards via config files</li>
<li>Persistent dashboard url's</li>
<li>Graphite Tags</li>
<li>Integrated function docs</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Release: <a href="https://grafana.com/blog/2018/03/01/grafana-v5.0-released/" target="_blank">https://grafana.com/blog/2018/03/01/grafana-v5.0-released/</a><br>
What's New: <a href="http://docs.grafana.org/guides/whats-new-in-v5/" target="_blank">http://docs.grafana.org/guides/whats-new-in-v5/</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/grafana/" data-title="01_grafana" id="sections_grafana_01_grafana3" class="slide small" data-transition="none">
<div class="content small" ref="sections/grafana/01_grafana:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Grafana</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Grafana Installation</h1>

<p>On RPM-based Linux systems like CentOS, Grafana can be installed via source, YUM repository or using YUM directly.</p>

<p>File: <strong>/etc/yum.repos.d/grafana.repo</strong></p>

<pre class="highlight"><code class="language-sh">[grafana]
name=grafana
baseurl=https://packagecloud.io/grafana/stable/el/7/\
  $basearch
repo_gpgcheck=1
enabled=1
gpgcheck=1
gpgkey=https://packagecloud.io/gpg.key \
  https://grafanarel.s3.amazonaws.com/RPM-GPG-KEY-grafana
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt</code></pre>

<p>Install Grafana:</p>

<pre class="highlight"><code class="language-sh"># yum -y install grafana</code></pre>

<p><strong>Note:</strong> Grafana is already pre-installed on "graphing1.localdomain".</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/grafana/" data-title="01_grafana" id="sections_grafana_01_grafana4" class="slide" data-transition="none">
<div class="content " ref="sections/grafana/01_grafana:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Grafana</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Grafana Server</h1>

<p>Start and enable the Grafana server:</p>

<pre class="highlight"><code class="language-sh"># systemctl start grafana-server.service
# systemctl enable grafana-server.service</code></pre>

<p>After that Grafana should be accessible via HTTP on port 3000 and the administrative user <strong>admin</strong> with password <strong>admin</strong>.</p>

<p>Basic settings like the used database, authentication or logging settings can be changed in <strong>/etc/grafana/grafana.ini</strong>. Grafana is even capable of sending its internal metrics to Graphite.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/grafana/" data-title="01_grafana" id="sections_grafana_01_grafana5" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/grafana/01_grafana:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Grafana</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Grafana Graphite Data Source</h1>

<p>The first step after installation is to add the Graphite data source:</p>

<p></p>
<center><img src="./file//sections/grafana/_images/grafana-graphite-datasource.png" style="width:320px;height:400px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/grafana/" data-title="01_grafana" id="sections_grafana_01_grafana6" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/grafana/01_grafana:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Grafana</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Grafana Dashboards</h1>

<p>You can either create dashboards by yourself or import them from <a href="https://grafana.com/dashboards" target="_blank">https://grafana.com/dashboards</a>.<br>
A good start with Graphite as backend is a dashboard called "Graphite Server (Carbon Metrics)" with ID "947".</p>

<p></p>
<center><img src="./file//sections/grafana/_images/grafana-graphite-dashboard.png" style="width:460px;height:244px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/grafana/" data-title="01_grafana" id="sections_grafana_01_grafana7" class="slide" data-transition="none">
<div class="content " ref="sections/grafana/01_grafana:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Grafana</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Custom Grafana Dashboards</h1>

<p>To build your own dashboards with Grafana you should start with the "Getting started" chapter of the official documentation, available at <a href="http://docs.grafana.org/guides/getting_started/" target="_blank">http://docs.grafana.org/guides/getting_started/</a>.</p>

<p>There's also a video with a 10min beginners guide from the main developer of Grafana, Torkel degaard, and many other assistances available.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="00_title" id="sections_cluster_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/cluster/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>7 Graphite Cluster</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/cluster/01_single:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>7.1 Single-Node Cluster</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single2" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/cluster/01_single:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite Single-Node Cluster</h1>

<p>In this scenario Carbon Relay distributes metrics over 2 Carbon Caches. As the communication between all Carbon daemons, they all can be located on different hosts.</p>

<p></p>
<center><img src="./file//sections/cluster/_images/graphite-cluster-middle.png" style="width:95%"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single3" class="slide small" data-transition="none">
<div class="content small" ref="sections/cluster/01_single:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Multiple Carbon Caches</h1>

<p>All Carbon daemons are configured in <strong>carbon.conf</strong> where each daemon gets its own section.</p>

<p>Configure multiple caches in <strong>/opt/graphite/conf/carbon.conf</strong>:</p>

<pre class="highlight"><code class="language-sh">[cache]
LINE_RECEIVER_PORT = 2023 
PICKLE_RECEIVER_PORT = 2024
CACHE_QUERY_PORT = 7002

[cache:b]
LINE_RECEIVER_PORT = 2123   # default: 2103
PICKLE_RECEIVER_PORT = 2124 # default: 2104
CACHE_QUERY_PORT = 7102</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single4" class="slide small" data-transition="none">
<div class="content small" ref="sections/cluster/01_single:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Cache Service Unit for additional instance</h1>

<p>File: <strong>/etc/systemd/system/carbon-cache-b.service</strong></p>

<pre class="highlight"><code class="language-sh">[Unit]
Description=Graphite Carbon Cache (instance b)
After=network.target

[Service]
Type=forking
StandardOutput=syslog
StandardError=syslog
ExecStart=/opt/graphite/bin/carbon-cache.py \
  --instance=b \
  --config=/opt/graphite/conf/carbon.conf \
  --pidfile=/var/run/carbon-cache-b.pid \
  --logdir=/var/log/carbon/ start
ExecReload=/bin/kill -USR1 $MAINPID
PIDFile=/var/run/carbon-cache-b.pid

[Install]
WantedBy=multi-user.target</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single5" class="slide small" data-transition="none">
<div class="content small" ref="sections/cluster/01_single:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Start Carbon Cache Daemon for additional instance</h1>

<p>Start Carbon Cache daemon for instance "b" with systemd:</p>

<pre class="highlight"><code class="language-sh"># systemctl daemon-reload
# systemctl start carbon-cache-b.service
# systemctl enable carbon-cache-b.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single6" class="slide small printonly" data-transition="none">
<div class="content small printonly" ref="sections/cluster/01_single:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Relay with Multiple Caches</h1>

<p>Add Carbon Cache instances to Relay configuration in <strong>carbon.conf</strong>:</p>

<pre class="highlight"><code class="language-sh">[relay]
LINE_RECEIVER_PORT = 2003
PICKLE_RECEIVER_PORT = 2004

RELAY_METHOD = consistent-hashing
REPLICATION_FACTOR = 1

DESTINATIONS = 127.0.0.1:2024:a, 127.0.0.1:2124:b</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single7" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/cluster/01_single:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite Single-Node Cluster with Graphite-Web</h1>

<p></p>
<center><img src="./file//sections/cluster/_images/graphite-cluster-graphite-web.png" style="width:460px"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single8" class="slide small" data-transition="none">
<div class="content small" ref="sections/cluster/01_single:8">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-Web with Multiple Caches</h1>

<p>Graphite-Web needs to be configured to query both Carbon Caches.</p>

<p>File: <strong>/opt/graphite/webapp/graphite/local_settings.py</strong>:</p>

<pre class="highlight"><code class="language-sh">CARBONLINK_HOSTS = ["127.0.0.1:7002:a", \
"127.0.0.1:7102:b"]</code></pre>

<p>Restart Apache:</p>

<pre class="highlight"><code class="language-sh"># systemctl restart httpd.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single9" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/cluster/01_single:9">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite Single-Node Cluster with Aggregator</h1>

<p></p>
<center><img src="./file//sections/cluster/_images/graphite-cluster-aggregator.png" style="width:460px"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single10" class="slide small printonly" data-transition="none">
<div class="content small printonly" ref="sections/cluster/01_single:10">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Relay with Aggregator</h1>

<p>Change Relay configuration in <strong>carbon.conf</strong>:</p>

<pre class="highlight"><code class="language-sh">[relay]
LINE_RECEIVER_PORT = 2003
PICKLE_RECEIVER_PORT = 2004

RELAY_METHOD = consistent-hashing
REPLICATION_FACTOR = 1

DESTINATIONS = 127.0.0.1:2014</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single11" class="slide small printonly" data-transition="none">
<div class="content small printonly" ref="sections/cluster/01_single:11">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Aggregator with Multiple Caches</h1>

<p>Change Aggregator configuration in <strong>carbon.conf</strong>:</p>

<pre class="highlight"><code class="language-sh">[aggregator]
LINE_RECEIVER_PORT = 2013
PICKLE_RECEIVER_PORT = 2014

FORWARD_ALL = True

DESTINATIONS = 127.0.0.1:2024:a, 127.0.0.1:2124:b

REPLICATION_FACTOR = 1</code></pre>

<p>Restart Carbon Aggregator:</p>

<pre class="highlight"><code class="language-sh"># systemctl restart carbon-aggregator.service</code></pre>

<p><strong>Note:</strong> The configuration for the Carbon Caches remains unchanged.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single12" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/cluster/01_single:12">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Metric routing of Carbon Aggregator</h1>

<p>The Aggregator does not have the same complement of routing methods as the Relay and supports only <code>consistent-hashing</code>. For <code>rule-based</code> routing an additional Relay beetwen Aggregator and Cache(s) is needed.</p>

<p></p>
<center><img src="./file//sections/cluster/_images/graphite-cluster-aggregator-relay.png" style="width:80%"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single13" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/cluster/01_single:13">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Queues and Caches</h1>

<p>Each Carbon daemon will start dropping or not accepting metrics if its queue or cache is full. The parameters <code>MAX_QUEUE_SIZE</code> and <code>MAX_CACHE_SIZE</code> are configured in <strong>carbon.conf</strong> in the proper section.</p>

<p></p>
<center><img src="./file//sections/cluster/_images/graphite-queues-and-caches.png" style="width:460px"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single14" class="slide small" data-transition="none">
<div class="content small" ref="sections/cluster/01_single:14">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbonate</h1>

<p>Carbonate brings some usefull tools to handle different tasks in Graphite clusters, for example to redistribute datapoints manually when new nodes are introduced.</p>

<pre class="highlight"><code class="language-sh"># pip install carbonate</code></pre>

<p>The configuration of Carbonate is done in: <strong>/opt/graphite/conf/carbonate.conf</strong></p>

<pre class="highlight"><code class="language-sh">[main]
DESTINATIONS = 127.0.0.1:2024:a, 127.0.0.1:2124:b
REPLICATION_FACTOR = 1
SSH_USER = carbonate # optional</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="01_single" id="sections_cluster_01_single15" class="slide small" data-transition="none">
<div class="content small" ref="sections/cluster/01_single:15">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbonate Tools</h1>

<table>
<thead>
<tr>
<th>Tool</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>carbon-hosts</strong></td>
<td>Return the addresses for all nodes in a cluster</td>
</tr>
<tr>
<td><strong>carbon-list</strong></td>
<td>List the metrics this carbon node contains</td>
</tr>
<tr>
<td><strong>carbon-lookup</strong></td>
<td>Lookup where a metric lives in a carbon cluster</td>
</tr>
<tr>
<td><strong>carbon-path</strong></td>
<td>Transform metric paths to (or from) filesystem paths</td>
</tr>
<tr>
<td><strong>carbon-sieve</strong></td>
<td>Given a list of metrics, output those that belong to a node</td>
</tr>
<tr>
<td><strong>carbon-stale</strong></td>
<td>Find and list potentially stale metrics</td>
</tr>
<tr>
<td><strong>carbon-sync</strong></td>
<td>Sync local metrics using remote nodes in the cluster</td>
</tr>
<tr>
<td><strong>whisper-aggregate</strong></td>
<td>Set aggregation for whisper-backed metrics this carbon instance contains</td>
</tr>
<tr>
<td><strong>whisper-fill</strong></td>
<td>Backfill datapoints from one whisper file into another</td>
</tr>
</tbody>
</table>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/graphite-project/carbonate" target="_blank">https://github.com/graphite-project/carbonate</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="02_multi" id="sections_cluster_02_multi1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/cluster/02_multi:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>7.2 Multi-Node Cluster</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="02_multi" id="sections_cluster_02_multi2" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/cluster/02_multi:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite Multi-Node Cluster</h1>

<p></p>
<center><img src="./file//sections/cluster/_images/graphite-big-cluster.png" style="width:460px"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="02_multi" id="sections_cluster_02_multi3" class="slide small" data-transition="none">
<div class="content small" ref="sections/cluster/02_multi:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Multiple Graphite-Web Instances</h1>

<p>For failover purposes of Graphite-Web we have to edit <code>CLUSTER_SERVERS</code>.</p>

<p>File: <strong>/opt/graphite/webapp/graphite/local_settings.py</strong></p>

<pre class="highlight"><code class="language-sh">CLUSTER_SERVERS = ["192.168.56.101", "192.168.56.102"]</code></pre>

<p>And reload Apache:</p>

<pre class="highlight"><code class="language-sh"># systemctl reload httpd.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="02_multi" id="sections_cluster_02_multi4" class="slide small" data-transition="none">
<div class="content small" ref="sections/cluster/02_multi:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Multiple Whisper Directories</h1>

<p>It's possible to use different storage directories for each Carbon Cache. We have to adjust the configuration in <strong>/opt/graphite/conf/carbon.conf</strong>:</p>

<pre class="highlight"><code class="language-sh">[cache]
LOCAL_DATA_DIR = /opt/graphite/storage/whisper1/

[cache:b]
LOCAL_DATA_DIR = /opt/graphite/storage/whisper2/</code></pre>

<p>Restart the Cache daemons:</p>

<pre class="highlight"><code class="language-sh"># systemctl restart carbon-cache-a.service
# systemctl restart carbon-cache-b.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="02_multi" id="sections_cluster_02_multi5" class="slide small" data-transition="none">
<div class="content small" ref="sections/cluster/02_multi:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Multiple Whisper Directories with Graphite-Web</h1>

<p>The configuration for Graphite-Web has to be changed in order to support different storage directories.</p>

<p>File: <strong>/opt/graphite/webapp/graphite/local_settings.py</strong></p>

<pre class="highlight"><code class="language-sh">STANDARD_DIRS = ["/opt/graphite/storage/whisper1", \
"/opt/graphite/storage/whisper2"]</code></pre>

<p>Afterwards Apache requires a reload:</p>

<pre class="highlight"><code class="language-sh"># systemctl reload httpd.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/cluster/" data-title="02_multi" id="sections_cluster_02_multi6" class="slide small" data-transition="none">
<div class="content small" ref="sections/cluster/02_multi:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Graphite Cluster</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite Multi-Node Cluster with collectd</h1>

<p>The <em>write_graphite</em> plugin of collectd is able to put metrics to all relays, but we have to edit the configuration for that and to restart collectd afterwards.</p>

<p>File: <strong>/etc/collectd.d/write_graphite.conf</strong></p>

<pre class="highlight"><code class="language-sh">&lt;Plugin write_graphite&gt;
  &lt;Node "graphing1"&gt;
    ...
  &lt;/Node&gt;
  &lt;Node "graphing2"&gt;
    Host "192.168.56.102"
    Port "2003"
    Protocol "tcp"
    ReconnectInterval 0
    LogSendErrors true
    Prefix "collectd."
    Postfix ""
    StoreRates true
    AlwaysAppendDS false
    EscapeCharacter "_"
    SeparateInstances false
    PreserveSeparator false
    DropDuplicateFields false
  &lt;/Node&gt;
&lt;/Plugin&gt;</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="00_title" id="sections_StatsD_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/StatsD/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>8 StatsD</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd1" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Overview of StatsD</h1>

<ul>
<li>Receive metrics via network (UDP/TCP)</li>
<li>Aggregate metrics</li>
<li>Transport metrics to one or multiple backends</li>
<li>No rendering of data</li>
<li>No collection of data</li>
<li>Runs on Node.js platform</li>
</ul>

<p>StatsD is most interesting for developers since it is very easy to embed code which sends metrics to a central StatsD.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/etsy/statsd" target="_blank">https://github.com/etsy/statsd</a><br>
Docs: <a href="https://github.com/etsy/statsd/tree/master/docs" target="_blank">https://github.com/etsy/statsd/tree/master/docs</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd2" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>StatsD and Graphite</h1>

<p>StatsD acts like a front-end proxy to Graphite. The major task of StatsD is to listen for metrics and periodically flush results to Graphite. Values of metrics that are being sent to StatsD may change during the time between receivement and forward to Graphite.</p>

<p>Key concept:</p>

<ul>
<li>Buckets

<ul>
<li>This represents one metric.</li>
</ul>
</li>
<li>Values

<ul>
<li>The value of a metric. This may change during the duration of the metric in StatsD.</li>
</ul>
</li>
<li>Flush

<ul>
<li>Writing collected data to a backend.</li>
</ul>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd3" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/StatsD/01_statsd:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>StatsD and Graphite</h1>

<p></p>
<center><img src="./file//sections/StatsD/_images/statsd-graphite.png" style="width:95%"></center>

<ol>
<li>Receive metrics</li>
<li>Collect for defined timeperiod</li>
<li>Aggregate properly</li>
<li>Flush to Graphite</li>
</ol>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd4" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>StatsD Installation</h1>

<p>StatsD requires Node.js to run, this requirement is automatically fullfilled during the package installation:</p>

<pre class="highlight"><code class="language-sh"># yum -y install statsd</code></pre>

<p><strong>Note:</strong> StatsD is already pre-installed on "graphing1.localdomain".</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd5" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>StatsD Configuration</h1>

<p>For a simple environment you need only a small piece of configuration. For everything else default settings are sufficient.</p>

<p>Make sure that <strong>/etc/statsd/config.js</strong> contains the following content:</p>

<pre class="highlight"><code class="language-ruby">{
  graphitePort: 2003
, graphiteHost: "localhost"
, port: 8125
, backends: [ "./backends/graphite" ]
, graphite: {
    legacyNamespace: false
  }
}</code></pre>

<p>To see all available settings, take a look into <strong>exampleConfig.js</strong>.</p>

<p>Start StatsD with systemd:</p>

<pre class="highlight"><code class="language-sh"># systemctl start statsd.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd6" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Metric Types (1/3)</h1>

<p>StatsD supports multiple types of metrics. Depending on the metric type datapoints a different aggregation method is applied.</p>

<p><strong>Counting</strong></p>

<p>A simple counter that adds a value to a bucket. On each flush interval the bucket gets written to Graphite and reset to 0.</p>

<pre class="highlight"><code class="language-sh">gitcommits:1|c</code></pre>

<p><strong>Timing</strong></p>

<p>The timing type comes in when measuring how long something took. For timers StatsD calculates automatically percentiles, average, standard deviation, sum, lower and upper bounds for each flush interval.</p>

<pre class="highlight"><code class="language-sh">request:480|ms</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd7" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Metric Types (2/3)</h1>

<p><strong>Gauge</strong></p>

<p>Arbitrary values that describe the current state of something. Gauge values are recorded as they are. By default, if a gauge metric does not change, StatsD will send the last value again to Graphite. This behaviour can be changed in the configuration. Gauge values can be increased or decreased instead of setting fixed values.</p>

<pre class="highlight"><code class="language-sh">processes:250|g
processes:-20|g
processes:+10|g</code></pre>

<p><strong>Sets</strong></p>

<p>When defining a set, StatsD counts all occurances of unique values between flush times. For example one could count the number of unique users logged in.</p>

<pre class="highlight"><code class="language-sh">userid:200|s</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd8" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:8">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Metric Types (3/3)</h1>

<p><strong>Multi-Metric Packets</strong></p>

<p>Multiple metrics can be sent to StatsD at once by seperating them with a newline. The size of one packet should not exceed the payload limit of your networks MTU.</p>

<pre class="highlight"><code class="language-sh">gitcommits:1|c\nprocesses:250|g\nresponse:200|s</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd9" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:9">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Storage Schema for StatsD</h1>

<p>The default flush interval of StatsD is 10 seconds. A proper storage schema needs to be created to handle this.</p>

<p>File: <strong>/opt/graphite/conf/storage-schemas.conf</strong></p>

<pre class="highlight"><code class="language-sh">[...]

[statsd]
pattern = ^stats
retentions = 10s:1d,1m:7d

[...]</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd10" class="slide small" data-transition="none">
<div class="content small" ref="sections/StatsD/01_statsd:10">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Storage Aggregation (1/2)</h1>

<p>Since StatsD supports several aggregation methods those need to be handled by Graphite too.</p>

<p>Add the following to <strong>/opt/graphite/conf/storage-aggregation.conf</strong>. Keep in mind that patterns are applied from top to bottom and first match wins. You should keep the following rules above other rules.</p>

<pre class="highlight"><code class="language-sh">[min]
pattern = \.lower$
xFilesFactor = 0.1
aggregationMethod = min

[max]
pattern = \.upper(_\d+)?$
xFilesFactor = 0.1
aggregationMethod = max

[sum]
pattern = \.sum$
xFilesFactor = 0
aggregationMethod = sum

...</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd11" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:11">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Storage Aggregation (2/2)</h1>

<p>Second part of <strong>/opt/graphite/conf/storage-aggregation.conf</strong>:</p>

<pre class="highlight"><code class="language-sh">...

[count]
pattern = \.count$
xFilesFactor = 0
aggregationMethod = sum

[count_legacy]
pattern = ^stats_counts.*
xFilesFactor = 0
aggregationMethod = sum

[default_average]
pattern = .*
xFilesFactor = 0.3
aggregationMethod = average</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd12" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:12">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Feed in your data</h1>

<p>Everything should be ready now to accept your data. Before starting you should clear Whisper files that may have been created automatically with wrong storage schemas:</p>

<pre class="highlight"><code class="language-sh"># rm -rf /opt/graphite/storage/whisper[1-2]/stats*</code></pre>

<p>Feeding data through StatsD to Graphite is as simple as writing directly to Graphite:</p>

<pre class="highlight"><code class="language-sh"># echo "mycounter:5|c" | nc -u -w1 localhost 8125
# echo "mygauge:230|g" | nc -u -w1 localhost 8125</code></pre>

<p>By repeating the counter within the flush interval will increase the resulting counter. The gauge value will be forwarded as is.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd13" class="slide small" data-transition="none">
<div class="content small" ref="sections/StatsD/01_statsd:13">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Admin Interface</h1>

<p>StatsD brings a simple TCP interface. It can be used to monitor a running StatsD server.</p>

<p>To interact with it, at first connect</p>

<pre class="highlight"><code class="language-sh"># nc localhost 8126</code></pre>

<p>Available commands:</p>

<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>stats</td>
<td>Some stats about the running server.</td>
</tr>
<tr>
<td>counters</td>
<td>A dump of all the current counters.</td>
</tr>
<tr>
<td>gauges</td>
<td>A dump of all the current gauges.</td>
</tr>
<tr>
<td>timers</td>
<td>A dump of the current timers.</td>
</tr>
<tr>
<td>delcounters</td>
<td>Delete a counter or folder of counters.</td>
</tr>
<tr>
<td>delgauges</td>
<td>Delete a gauge or folder of gauges.</td>
</tr>
<tr>
<td>deltimers</td>
<td>Delete a timer or folder of timers.</td>
</tr>
<tr>
<td>health</td>
<td>A way to set the health status of statsd.</td>
</tr>
</tbody>
</table>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd14" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:14">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Client Libraries</h1>

<p>For all common programing languages libraries exist that enable you to talk to StatsD and send datapoints. In addition, some applications support StatsD natively or with a plugin.</p>

<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Node</td>
<td>Java</td>
</tr>
<tr>
<td>Python</td>
<td>Ruby</td>
</tr>
<tr>
<td>Perl</td>
<td>PHP</td>
</tr>
<tr>
<td>Clojure</td>
<td>Io</td>
</tr>
<tr>
<td>C</td>
<td>CPP</td>
</tr>
<tr>
<td>.NET</td>
<td>Go</td>
</tr>
<tr>
<td>Apache</td>
<td>Varnish</td>
</tr>
<tr>
<td>PowerShell</td>
<td>Browser</td>
</tr>
<tr>
<td>Objective-C</td>
<td>ActionScript</td>
</tr>
<tr>
<td>Wordpress</td>
<td>Drupal</td>
</tr>
<tr>
<td>Haskell</td>
<td></td>
</tr>
</tbody>
</table>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd15" class="slide" data-transition="none">
<div class="content " ref="sections/StatsD/01_statsd:15">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Logstash Output Plugin</h1>

<p>Logstash brings a built-in output plugin for StatsD. Here is an example on how to use it for Apache logs we covered in the Logstash section.</p>

<p>File: <strong>/etc/logstash/conf.d/filter.conf</strong></p>

<pre class="highlight"><code class="language-ruby">output {
  statsd {
    host =&gt; "127.0.0.1"
    port =&gt; 8125
    increment  =&gt; ["apache.response.%{response}"]
    count =&gt; { "apache.bytes" =&gt; "%{bytes}" }
  } 
}</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/StatsD/" data-title="01_statsd" id="sections_StatsD_01_statsd16" class="slide small" data-transition="none">
<div class="content small" ref="sections/StatsD/01_statsd:16">
<h1 class="section_title">~~~SECTION:MAJOR~~~ StatsD</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Third Party Backends</h1>

<p>Beside the default Graphite backend, there are also several other backends which are not maintained by the StatsD project.</p>

<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>amqp</td>
<td>librato</td>
</tr>
<tr>
<td>atsd</td>
<td>mongo</td>
</tr>
<tr>
<td>aws-cloudwatch</td>
<td>monitis</td>
</tr>
<tr>
<td>node-bell</td>
<td>netuitive</td>
</tr>
<tr>
<td>couchdb</td>
<td>opentsdb</td>
</tr>
<tr>
<td>datadog</td>
<td>socket.io</td>
</tr>
<tr>
<td>elasticsearch</td>
<td>stackdriver</td>
</tr>
<tr>
<td>ganglia</td>
<td>statsd</td>
</tr>
<tr>
<td>hosted graphite</td>
<td>statsd http</td>
</tr>
<tr>
<td>influxdb</td>
<td>statsd aggregation</td>
</tr>
<tr>
<td>instrumental</td>
<td>warp10</td>
</tr>
<tr>
<td>jut</td>
<td>zabbix</td>
</tr>
<tr>
<td>leftronic</td>
<td></td>
</tr>
</tbody>
</table>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Backends: <a href="https://github.com/etsy/statsd/blob/master/docs/backend.md" target="_blank">https://github.com/etsy/statsd/blob/master/docs/backend.md</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="00_title" id="sections_influxdb_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/influxdb/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>9 InfluxDB</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb1" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/influxdb/01_influxdb:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Overview of InfluxDB</h1>

<ul>
<li>Time series data storage</li>
<li>Part of TICK Stack</li>
<li>Stores event data (exceptions, deploys, logins, ...)</li>
<li>SQL like query language</li>
<li>HTTP(S) API</li>
<li>No rendering or collection of data</li>
<li>Written in Go</li>
</ul>

<p><strong>Note:</strong> Unfortunately High-Availability and Clustering are features of InfluxEnterprise only.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>InfluxData: <a href="https://www.influxdata.com" target="_blank">https://www.influxdata.com</a><br>
Docs: <a href="https://docs.influxdata.com" target="_blank">https://docs.influxdata.com</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb2" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/influxdb/01_influxdb:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>TICK Stack</h1>

<p></p>
<center><img src="./file//sections/influxdb/_images/Tick-Stack-Complete.png" style="width:420px;height:332px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb3" class="slide small" data-transition="none">
<div class="content small" ref="sections/influxdb/01_influxdb:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>InfluxData Installation</h1>

<p>InfluxData provides packages for most common used Unix operating systems.</p>

<p>File: <strong>/etc/yum.repos.d/influxdb.repo</strong></p>

<pre class="highlight"><code class="language-sh">[influxdb]
name = InfluxDB Repository - RHEL \$releasever
baseurl = https://repos.influxdata.com/rhel/\$releasever/\
  $basearch/stable
enabled = 1
gpgcheck = 1
gpgkey = https://repos.influxdata.com/influxdb.key

# yum -y install influxdb chronograf telegraf</code></pre>

<p><strong>Note:</strong> InfluxDB, Chronograf and Telegraf are already pre-installed on "graphing1.localdomain".</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb4" class="slide small" data-transition="none">
<div class="content small" ref="sections/influxdb/01_influxdb:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>InfluxData Services</h1>

<p>We have to start InfluxDB, Chronograf and Telegraf:</p>

<pre class="highlight"><code class="language-sh"># systemctl start influxdb.service
# systemctl start chronograf.service
# systemctl start telegraf.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb5" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/influxdb/01_influxdb:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>InfluxDB Ports</h1>

<p>InfluxDB opens a bunch of ports. Not all of them are used by default, but its good to know what they are useful for.</p>

<ul>
<li>Default ports

<ul>
<li>
<code>8086</code>: HTTP(S) API for client-server communication</li>
<li>
<code>8088</code>: RPC service for backup and restore</li>
<li>
<code>8888</code>: Chronograf webinterface</li>
</ul>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb6" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/influxdb/01_influxdb:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Chronograf Setup</h1>

<p>Chronograf is available on "graphing1.localdomain" on port "8888". We have to setup a new connection to InfluxDB and the name of the Telegraf database.</p>

<p></p>
<center><img src="./file//sections/influxdb/_images/chronograf-setup.png" style="width:460px;height:270px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb7" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/influxdb/01_influxdb:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Chronograf Host List</h1>

<p>Chronograf's Host List Menu shows metrics collected from Telegraf:</p>

<p></p>
<center><img src="./file//sections/influxdb/_images/chronograf-host-list.png" style="width:460px;height:247px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb8" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:8">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Telegraf Plugins</h1>

<ul>
<li>Default data collection interval is 10s</li>
<li>&gt; 70 input plugins

<ul>
<li>Docker, Kubernetes, MongoDB, Prometheus, Puppet Agent, StatsD, etc.</li>
</ul>
</li>
<li>&gt; 20 output plugins

<ul>
<li>Elasticsearch, Graphite, Graylog, Kafka, OpenTSDB, Prometheus, etc.</li>
</ul>
</li>
</ul>

<p>Telegraf provides a built-in output for Graphite.</p>

<p>File: <strong>/etc/telegraf/telegraf.conf</strong></p>

<pre class="highlight"><code class="language-sh">[[outputs.graphite]]
    servers = ["localhost:2003"]
    prefix = "telegraf"</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb9" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:9">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Telegraf Graphite Output Plugin</h1>

<p>Care about a proper storage schema:</p>

<p>File: <strong>/opt/graphite/conf/storage-schemas.conf</strong></p>

<pre class="highlight"><code class="language-sh">[...]

[telegraf]
pattern = ^telegraf\.
retentions = 10s:5d

[...]</code></pre>

<p>Restart Telegraf with systemd:</p>

<pre class="highlight"><code class="language-sh"># systemctl restart telegraf.service</code></pre>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Telegraf plugins: <a href="https://docs.influxdata.com/telegraf/latest/plugins" target="_blank">https://docs.influxdata.com/telegraf/latest/plugins</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb10" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:10">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>InfluxDB Data Model</h1>

<pre class="highlight"><code class="language-sh">name: cpu
time                   usage_system   host
----                   ------------   ----
04/12/18 02:11:30PM    0.35087        graphing1
04/12/18 02:11:40PM    0.30075        graphing2
04/12/18 02:11:50PM    0.25075        graphing1</code></pre>

<ul>
<li>
<strong>Measurement:</strong> cpu</li>
<li>
<strong>Field key:</strong> usage_system</li>
<li>
<strong>Field values:</strong> 0.35087, 0.30075, 0.25075</li>
<li>
<strong>Tag key:</strong> host</li>
<li>
<strong>Tag values:</strong> graphing1, graphing2</li>
</ul>

<p>Line protocol:</p>

<pre class="highlight"><code class="language-sh">cpu,host=graphing1 usage_system=0.35087 1523539329
measurement,tag(s) field(s) timestamp</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb11" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:11">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Write Data Using HTTP API</h1>

<p>The easiest method for adding datapoints to a InfluxDB database is by using the HTTP API. Most client libraries use this and its easy to build into custom applications.
Here is an example how you could use InfluxDB as metric database.</p>

<pre class="highlight"><code class="language-sh"># curl -i -XPOST http://localhost:8086/query \
--data-urlencode "q=CREATE DATABASE metrics"

# curl -i -XPOST 'http://localhost:8086/write?db=metrics' \
--data-binary 'cpu,host=graphing1,region=europe \
value=0.64 1523540001'</code></pre>

<p>Multiple Points:</p>

<pre class="highlight"><code class="language-sh"># curl -i -XPOST 'http://localhost:8086/write?db=metrics' \
--data-binary 'cpu,host=graphing2 value=0.67 \
cpu,host=graphing1,region=europe value=2.0 \
cpu,host=graping2 value=1.20 1422568543702900257'</code></pre>

<p><strong>Note:</strong> If points are provided without timestamp, the server's local timestamp is used.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb12" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:12">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>HTTP Repsonses</h1>

<ul>
<li>
<strong>2xx</strong>: If your write request received <code>HTTP 204 No Content</code>, it was a success!</li>
<li>
<strong>4xx</strong>: InfluxDB could not understand the request.</li>
<li>
<strong>5xx</strong>: The system is overloaded or significantly impaired.</li>
</ul>

<p>Example output after adding points:</p>

<pre class="highlight"><code class="language-sh">HTTP/1.1 204 No Content
Content-Type: application/json
Request-Id: e28fee07-4cde-11e7-8083-000000000000
X-Influxdb-Version: 1.2.4
Date: Fri, 09 Jun 2017 06:43:02 GMT</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb13" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:13">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Query Data Using HTTP API</h1>

<p>The output of queries is returned in JSON:</p>

<pre class="highlight"><code class="language-sh"># curl -G 'http://localhost:8086/query?pretty=true' \
--data-urlencode "db=metrics" --data-urlencode \
"q=SELECT \"value\" FROM \"cpu\" WHERE \
\"region\"='us-west'"</code></pre>

<p>Multiple queries can be stacked together with semicolon as delimiter:</p>

<pre class="highlight"><code class="language-sh"># curl -G 'http://localhost:8086/query?pretty=true' \
--data-urlencode "db=metrics" --data-urlencode \
"q=SELECT \"value\" FROM \"cpu\" WHERE \
\"region\"='us-west'; SELECT count(\"value\") \
FROM \"cpu\" WHERE \"region\"='us-west'"</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb14" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:14">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>InfluxDB Shell</h1>

<p>The InfluxDB Shell is part of every InfluxDB installation.</p>

<pre class="highlight"><code class="language-sh"># influx
Connected to http://localhost:8086 version 1.5.1
InfluxDB shell version: 1.5.1

&gt; CREATE DATABASE metrics

&gt; USE metrics
Using database metrics

&gt; INSERT cpu,host=graphing2,region=us-west value=0.64
&gt; INSERT cpu,host=graphing1,region=europe value=0.23

&gt; SELECT * FROM "cpu"
name: cpu
time       host      region  value
----       ----      ------  -----
1523540001 graphing1 us-west 0.64
1523540064 graphing1 europe  0.23

&gt; quit</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb15" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:15">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>InfluxDB Listeners</h1>

<ul>
<li>HTTP API

<ul>
<li>Send Post request to with a proper body to InfluxDB to add datapoints to a database.</li>
<li>Default port: <code>8086</code>
</li>
</ul>
</li>
<li>Graphite

<ul>
<li>Support for Carbon protocol, which Graphite uses for receiving metrics.</li>
</ul>
</li>
<li>collectd

<ul>
<li>collectd has its own binary protocol to communicate with other collectd nodes.</li>
<li>Default port: <code>25826</code>
</li>
</ul>
</li>
<li>OpenTSDB

<ul>
<li>InfluxDB supports both the telnet and HTTP OpenTSDB protocol.</li>
<li>Default port: <code>4242</code>
</li>
</ul>
</li>
<li>UDP

<ul>
<li>Sending data in JSON format via UDP is supported.</li>
<li>Default port: <code>8089</code>
</li>
</ul>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb16" class="slide small" data-transition="none">
<div class="content small" ref="sections/influxdb/01_influxdb:16">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Prepare InfluxDB for collectd</h1>

<p>Both, "CollectD" and "Graphite"-Service Plugins can be used to connect collectd to InfluxDB. In this case we want to use the "CollectD" Service Plugin and enable it in <strong>/etc/influxdb/influxdb.conf</strong>:</p>

<pre class="highlight"><code class="language-sh">[[collectd]]
  enabled = true
  bind-address = ":25826"
  database = "collectd"</code></pre>

<p>After a restart of InfluxDB the <code>collectd</code> database must be created manually:</p>

<pre class="highlight"><code class="language-sh"># systemctl restart influxdb.service

# curl -i -XPOST http://localhost:8086/query \
--data-urlencode "q=CREATE DATABASE collectd"</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb17" class="slide small" data-transition="none">
<div class="content small" ref="sections/influxdb/01_influxdb:17">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Connect collectd to InfluxDB</h1>

<p>InfluxDB opens port 25826 after the restart, so we can connect collectd to send data to InfluxDB.</p>

<p>File: <strong>/etc/collectd.d/network.conf</strong></p>

<pre class="highlight"><code class="language-sh">LoadPlugin network

&lt;Plugin network&gt;
  Server "localhost" "25826"
&lt;/Plugin&gt; </code></pre>

<p>And reload the collectd daemon afterwards:</p>

<pre class="highlight"><code class="language-sh"># systemctl restart collectd.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb18" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/influxdb/01_influxdb:18">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Chronograf Data Explorer</h1>

<p>With the Data Explorer included in Chronograf you can create, edit and delete databases. Also data can be explored by using the build in query language.</p>

<p></p>
<center><img src="./file//sections/influxdb/_images/chronograf-data-explorer.png" style="width:460px;height:247px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb19" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:19">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Influx Query Language</h1>

<p>Influx Query Language (InfluxQL) is InfluxDBs SQL-like query language for interacting with data in InfluxDB:</p>

<ul>
<li>Data exploration: <code>SELECT</code>, <code>WHERE</code>, <code>GROUP BY</code>, <code>INTO</code>
</li>
<li>Schema exploration: <code>SHOW</code>
</li>
<li>Data mangement: <code>CREATE</code>, <code>DROP</code>, <code>DELETE</code>, <code>ALTER</code>
</li>
<li>InfluxQL continuous queries</li>
<li>InfluxQL functions: Aggregations, Selectors, Transformations, Predictors</li>
<li>InfluxQL mathematical operators</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>InfluxQL: <a href="https://docs.influxdata.com/influxdb/latest/query_language/" target="_blank">https://docs.influxdata.com/influxdb/latest/query_language/</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb20" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:20">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>InfluxQL Examples (1/2)</h1>

<p>Return a list of series for the specified database:</p>

<pre class="highlight"><code class="language-sql">SHOW SERIES ON "collectd"</code></pre>

<p>Return a list of measurements:</p>

<pre class="highlight"><code class="language-sql">SHOW MEASUREMENTS ON "collectd"</code></pre>

<p>Return a list of tag keys:</p>

<pre class="highlight"><code class="language-sql">SHOW TAG KEYS ON "collectd"</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb21" class="slide small" data-transition="none">
<div class="content small" ref="sections/influxdb/01_influxdb:21">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>InfluxQL Examples (2/2)</h1>

<p>Load of one server:</p>

<pre class="highlight"><code class="language-sql">SELECT "time", "host", "value" FROM "collectd".\
  "autogen"."load_shortterm"

SELECT * FROM "collectd"."autogen"."load_shortterm"
  WHERE "host" = 'graphing1.localdomain'</code></pre>

<p>Select timeframe:</p>

<pre class="highlight"><code class="language-sql">SELECT * FROM "collectd"."autogen"."load_shortterm"
  WHERE time &gt; now() - 1h

SELECT * FROM load_shortterm
  WHERE time &lt; '2018-03-18 12:50' 
  WHERE time &gt; '2018-04-18 12:50'</code></pre>

<p>Delete data:</p>

<pre class="highlight"><code class="language-sql">DELETE FROM "collectd"."autogen"."load_shortterm"
  WHERE time &gt; now() - 1h</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb22" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/influxdb/01_influxdb:22">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Grafana InfluxDB Data Source</h1>

<p>Add the InfluxDB data source with the "<strong>collectd</strong>" database to Grafana:</p>

<p></p>
<center><img src="./file//sections/influxdb/_images/grafana-influxdb-datasource.png" style="width:321px;height:450px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb23" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:23">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>InfluxGraph</h1>

<p>InfluxGraph (formerly: Graphite-InfluxDB) is a storage plugin to use InfluxDB as a drop-in replacement data store to the Graphite query API</p>

<p></p>
<center><img src="./file//sections/influxdb/_images/influxdb-influxgraph.png" style="width:400px;height:330px;"></center>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/InfluxGraph/influxgraph" target="_blank">https://github.com/InfluxGraph/influxgraph</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/influxdb/" data-title="01_influxdb" id="sections_influxdb_01_influxdb24" class="slide" data-transition="none">
<div class="content " ref="sections/influxdb/01_influxdb:24">
<h1 class="section_title">~~~SECTION:MAJOR~~~ InfluxDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Stop Services</h1>

<p>We have to stop serval services due to limited system resources in our training environment:</p>

<pre class="highlight"><code class="language-sh"># systemctl stop statsd.service
# systemctl stop telegraf.service
# systemctl stop chronograf.service
# systemctl stop influxdb.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/opentsdb/" data-title="00_title" id="sections_opentsdb_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/opentsdb/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ OpenTSDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>10 OpenTSDB</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/opentsdb/" data-title="01_opentsdb" id="sections_opentsdb_01_opentsdb1" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/opentsdb/01_opentsdb:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ OpenTSDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>OpenTSDB</h1>

<ul>
<li>Time series database</li>
<li>Scalable</li>
<li>Distributed</li>
<li>HTTP API</li>
<li>No rendering of data</li>
<li>No collection of data</li>
<li>Based on HBase</li>
<li>Language: Java</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="http://opentsdb.net" target="_blank">http://opentsdb.net</a><br>
Docs: <a href="http://opentsdb.net/docs/build/html" target="_blank">http://opentsdb.net/docs/build/html</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/opentsdb/" data-title="01_opentsdb" id="sections_opentsdb_01_opentsdb2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/opentsdb/01_opentsdb:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ OpenTSDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>OpenTSDB</h1>

<p>OpenTSDB is a time series database based on Apaches HBase. With this underlying technology it is possible to distribute and scale data across a big amount of servers.</p>

<ul>
<li>Time Series Daemon (TSD)

<ul>
<li>One or multiple daemons that talk to HBase</li>
<li>TSDs are independent from each other</li>
</ul>
</li>
<li>HTTP API

<ul>
<li>User do not need to talk to HBase</li>
</ul>
</li>
<li>Telnet interface</li>
<li>Simple built-in GUI</li>
<li>Commandline Tools</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="http://opentsdb.net" target="_blank">http://opentsdb.net</a><br>
Docs: <a href="http://opentsdb.net/docs/build/html" target="_blank">http://opentsdb.net/docs/build/html</a><br>
HBase: <a href="http://hbase.apache.org" target="_blank">http://hbase.apache.org</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/opentsdb/" data-title="01_opentsdb" id="sections_opentsdb_01_opentsdb3" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/opentsdb/01_opentsdb:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ OpenTSDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>OpenTSDB Concept</h1>

<p></p>
<center><img src="./file//sections/opentsdb/_images/opentsdb-concept.png" style="width:460px"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/opentsdb/" data-title="01_opentsdb" id="sections_opentsdb_01_opentsdb4" class="slide small" data-transition="none">
<div class="content small" ref="sections/opentsdb/01_opentsdb:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ OpenTSDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>OpenTSDB Metrics</h1>

<p>OpenTSDB uses some kind of Graphites metric path combined with tags to identify datapoints:</p>

<pre class="highlight"><code class="language-sh">&lt;metric&gt; &lt;timestamp&gt; &lt;value&gt; &lt;tagk1=tagv1 ... tagkN=tagvN&gt;
sys.cpu.user 1356998400 42.5 host=webserver01 cpu=0</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/opentsdb/" data-title="01_opentsdb" id="sections_opentsdb_01_opentsdb5" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/opentsdb/01_opentsdb:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ OpenTSDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>OpenTSDB Collectors</h1>

<p>To collect data several clients are available:</p>

<ul>
<li>TCollector<br>
<a href="http://opentsdb.net/docs/build/html/user_guide/utilities/tcollector.html" target="_blank">http://opentsdb.net/docs/build/html/user_guide/utilities/tcollector.html</a>
</li>
<li>SCollector (API v2)<br>
<a href="http://bosun.org/scollector/" target="_blank">http://bosun.org/scollector/</a>
</li>
<li>collectd<br>
<a href="https://github.com/auxesis/collectd-opentsdb" target="_blank">https://github.com/auxesis/collectd-opentsdb</a>
</li>
<li>Icinga 2<br>
<a href="https://www.icinga.com" target="_blank">https://www.icinga.com</a>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/opentsdb/" data-title="01_opentsdb" id="sections_opentsdb_01_opentsdb6" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/opentsdb/01_opentsdb:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ OpenTSDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>OpenTSDB Client Libraries</h1>

<p>For communication with OpenTSDB multiple client libraries exist. Some of them can just pull data where other may read and write metrics.</p>

<ul>
<li>R (read) </li>
<li>Erlang (write)</li>
<li>Ruby (read/write)</li>
<li>Go (read/write) </li>
<li>Python (write)</li>
<li>vert.x (write)</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/opentsdb/" data-title="01_opentsdb" id="sections_opentsdb_01_opentsdb7" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/opentsdb/01_opentsdb:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ OpenTSDB</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>OpenTSDB Frontends</h1>

<p>Beside the simple built-in GUI there are some other webinterfaces for OpenTSDB dashboards:</p>

<ul>
<li><p>Grafana<br>
<a href="http://grafana.org" target="_blank">http://grafana.org</a></p></li>
<li><p>TSDash<br>
<a href="https://github.com/facebookarchive/tsdash" target="_blank">https://github.com/facebookarchive/tsdash</a></p></li>
<li><p>OpenTSDB Dashboard<br>
<a href="https://github.com/turn/opentsdb-dashboard" target="_blank">https://github.com/turn/opentsdb-dashboard</a></p></li>
<li><p>Status Wolf<br>
<a href="https://github.com/box/StatusWolf" target="_blank">https://github.com/box/StatusWolf</a></p></li>
<li><p>Metrilyx<br>
<a href="https://github.com/Ticketmaster/metrilyx-2.0" target="_blank">https://github.com/Ticketmaster/metrilyx-2.0</a></p></li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="00_title" id="sections_icinga_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/icinga/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>11 Icinga</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="01_icinga" id="sections_icinga_01_icinga1" class="slide" data-transition="none">
<div class="content " ref="sections/icinga/01_icinga:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Icinga Overview</h1>

<ul>
<li>Active and passive monitoring</li>
<li>Wide choice of plugins

<ul>
<li>CPU, Load, Memory, Disk, ...</li>
<li>Dell, Hewlett Packard, Microsoft, VMware, Juniper, ...</li>
</ul>
</li>
<li>Performance data included</li>
<li>Scalable</li>
<li>Alerting</li>
<li>Native Graphite support (since Icinga 2)</li>
</ul>

<p>Icinga is actually a tool for availability monitoring, which tells you if your hosts or services have any problems. As a part of this monitoring most of the plugins are able to deliver also performance data.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://www.icinga.com" target="_blank">https://www.icinga.com</a><br>
Docs: <a href="https://www.icinga.com/resources/docs" target="_blank">https://www.icinga.com/resources/docs</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="01_icinga" id="sections_icinga_01_icinga2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/icinga/01_icinga:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Icinga Checks</h1>

<p>Icinga executes checks and evaluates results to trigger notifications or events. A spin-off product of these checks are performance data.</p>

<ul>
<li>Checks run periodically</li>
<li>Checks can be

<ul>
<li>disk, load, memory, cpu, processes, ...</li>
<li>VMWare, Microsoft, Dell, HP, ...</li>
<li>MySQL, PostgreSQL, Apache2, NginX, ...</li>
<li>Many more</li>
</ul>
</li>
<li>Full compatibility to Nagios plugins</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="01_icinga" id="sections_icinga_01_icinga3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/icinga/01_icinga:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Forwarding Data with Icinga 2</h1>

<p>One of Icinga 2's key features is the forwarding of stuff. Nearly any data can be forwarded to one or multiple backends.</p>

<ul>
<li>
<p>Forward</p>

<ul>
<li>Performance Data</li>
<li>Check results</li>
<li>Thresholds</li>
<li>Logs</li>
</ul>
</li>
<li>
<p>Forward to</p>

<ul>
<li>Graphite</li>
<li>InfluxDB/OpenTSDB</li>
<li>Graylog/Logstash</li>
<li>PNP4Nagios</li>
<li>Elasticsearch</li>
</ul>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="01_icinga" id="sections_icinga_01_icinga4" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/icinga/01_icinga:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Training Environment</h1>

<p>One of your training virtual machines already includes the following installation:</p>

<ul>
<li>Icinga 2 Core

<ul>
<li>Monitoring plugins</li>
<li>IDO support (MariaDB Database)</li>
</ul>
</li>
<li>Icinga Web 2</li>
</ul>

<p></p>
<center><img src="./file//sections/icinga/_images/icinga2-installation-overview.png" style="width:460px;height:290px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="01_icinga" id="sections_icinga_01_icinga5" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/icinga/01_icinga:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Icinga Web 2</h1>

<p>Icinga Web 2 is a webinterface for Icinga. You can view the current state of your hosts and services and check out historical data.</p>

<ul>
<li>Create dashboards</li>
<li>Current and historical states</li>
<li>Groups</li>
<li>Contacts</li>
<li>Acknowledge problems</li>
<li>Set downtimes</li>
<li>Comments</li>
<li>Reschedule checks</li>
<li>Reporting</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="01_icinga" id="sections_icinga_01_icinga6" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/icinga/01_icinga:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Icinga Web 2</h1>

<p>Icinga Web 2 is available on "graphing1.localdomain" under "/icingaweb2" with user <strong>icingaadmin</strong> and password <strong>icinga</strong>.</p>

<p></p>
<center><img src="./file//sections/icinga/_images/icingaweb2.png" style="width:460px;height:244px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="01_icinga" id="sections_icinga_01_icinga7" class="slide small" data-transition="none">
<div class="content small" ref="sections/icinga/01_icinga:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Storage Schema for Icinga 2</h1>

<p>Icinga 2 provides a storage schema with use for Graphite. Keep in mind that storage schemas are applied from the top to the bottom and the first match wins. How your storage schema looks like depends on your check intervals. By default the check interval is set to 1 minute.</p>

<p>File: <strong>/opt/graphite/conf/storage-schemas.conf</strong></p>

<pre class="highlight"><code class="language-sh">[...]

[icinga2_metadata]
pattern = ^icinga2\..*\.metadata\.
retentions = 1m:7d

[icinga2_perfdata]
pattern = ^icinga2\..*\.perfdata\.
retentions = 1m:2d,5m:10d,30m:90d,360m:4y

[...]</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="01_icinga" id="sections_icinga_01_icinga8" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/icinga/01_icinga:8">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Threshold Metrics</h1>

<p>Many of the Icinga plugins provide configured thresholds in addition to the performance counters. This is very useful when creating graphs using this data.</p>

<p></p>
<center><img src="./file//sections/icinga/_images/icinga2-grafana.png" style="width:90%"></center>

<p>With graphs that show thresholds one can see occuring problems on first sight.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="01_icinga" id="sections_icinga_01_icinga9" class="slide small" data-transition="none">
<div class="content small" ref="sections/icinga/01_icinga:9">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Icinga 2 Graphite Feature</h1>

<p>To add Graphite support to Icinga 2 you need to enable and configure the proper feature.</p>

<pre class="highlight"><code class="language-sh"># icinga2 feature enable graphite</code></pre>

<p>Edit the configuration for the Graphite feature and enable at least sending of thresholds.</p>

<p>File: <strong>/etc/icinga2/features-enabled/graphite.conf</strong></p>

<pre class="highlight"><code class="language-sh">object GraphiteWriter "graphite" {
  host = "127.0.0.1"            // default
  port = 2003                   // default

  enable_send_thresholds = true // required
  enable_send_metadata = true   // optional
}</code></pre>

<p>Validate the configuration and restart Icinga 2:</p>

<pre class="highlight"><code class="language-sh"># icinga2 daemon -C
# systemctl restart icinga2.service</code></pre>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Docs: <a href="https://www.icinga.com/docs/icinga2/latest/doc/09-object-types/#graphitewriter" target="_blank">https://www.icinga.com/docs/icinga2/latest/doc/09-object-types/#graphitewriter</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="01_icinga" id="sections_icinga_01_icinga10" class="slide small" data-transition="none">
<div class="content small" ref="sections/icinga/01_icinga:10">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Icinga 2 InfluxDB Feature</h1>

<p>Enabling the Icinga InfluxDB feature is similar than the Graphite feature:</p>

<pre class="highlight"><code class="language-sh"># icinga2 feature enable influxdb</code></pre>

<p>File: <strong>/etc/icinga2/features-enabled/influxdb.conf</strong></p>

<pre class="highlight"><code class="language-sh">object InfluxdbWriter "influxdb" {
  host = "127.0.0.1"            // default
  port = 8086                   // default
  database = "icinga2"          // default
  ...

  enable_send_thresholds = true // optional
  enable_send_metadata = true   // optional
}</code></pre>

<p>Validate the configuration and restart Icinga 2:</p>

<pre class="highlight"><code class="language-sh"># icinga2 daemon -C
# systemctl restart icinga2.service</code></pre>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Docs: <a href="https://www.icinga.com/docs/icinga2/latest/doc/09-object-types/#influxdbwriter" target="_blank">https://www.icinga.com/docs/icinga2/latest/doc/09-object-types/#influxdbwriter</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/icinga/" data-title="01_icinga" id="sections_icinga_01_icinga11" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/icinga/01_icinga:11">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Icinga</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Grafana Dashboard</h1>

<p>With Icinga 2 as Collector you can import a dashboard called "<strong>Icinga2 with Graphite</strong>" provided by the Icinga Project with ID "56".</p>

<p></p>
<center><img src="./file//sections/icinga/_images/grafana-dashboard.png" style="width:460px;height:203px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="00_title" id="sections_integrations_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/integrations/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>12 Integrations</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="01_monitoring" id="sections_integrations_01_monitoring1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/integrations/01_monitoring:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>12.1 Graph Monitoring</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="01_monitoring" id="sections_integrations_01_monitoring2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/integrations/01_monitoring:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graph Monitoring</h1>

<p>Icinga can be used to monitor nearly anything. It goes without saying that there is a way you can monitor also your graphs with it.</p>

<ul>
<li>
<code>check_graphite</code> plugin to check graphs:

<ul>
<li>Set any metric path</li>
<li>Set thresholds</li>
<li>Set timeframe</li>
<li>Apply function on target metric</li>
</ul>
</li>
</ul>

<p><strong>Note:</strong> The <code>check_graphite</code> plugin and its dependency <code>rubygem-rest-client</code> are already pre-installed on "graphing1.localdomain".</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/obfuscurity/nagios-scripts" target="_blank">https://github.com/obfuscurity/nagios-scripts</a><br>
Docs: <a href="http://obfuscurity.com/2012/05/Polling-Graphite-with-Nagios" target="_blank">http://obfuscurity.com/2012/05/Polling-Graphite-with-Nagios</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="01_monitoring" id="sections_integrations_01_monitoring3" class="slide small printonly" data-transition="none">
<div class="content small printonly" ref="sections/integrations/01_monitoring:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graph Monitoring</h1>

<p>Add a new service to one of your hosts to check metrics from Graphite. Ideally the datapoints you are checking do not come from Icinga itself. The CheckCommand for the <code>check_graphite</code> plugin is provided via Icinga Template Library (ITL).</p>

<p>File: <strong>/etc/icinga2/training/services.conf</strong></p>

<pre class="highlight"><code class="language-sh">apply Service "graphite-load" {
  import "generic-service"

  check_command = "graphite"

  vars.graphite_url = "http://graphite"
  vars.graphite_metric = "collectd.graphing1.load.\
    load.shortterm"
  vars.graphite_warning = 1
  vars.graphite_critical = 2
  vars.graphite_duration = 5

  assign where host.name == "graphing1.localdomain"
}</code></pre>

<p>Validate the configuration and reload Icinga 2:</p>

<pre class="highlight"><code class="language-sh"># icinga2 daemon -C
# systemctl reload icinga2.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="02_icingabeat" id="sections_integrations_02_icingabeat1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/integrations/02_icingabeat:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>12.2 Icingabeat</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="02_icingabeat" id="sections_integrations_02_icingabeat2" class="slide small printonly" data-transition="none">
<div class="content small printonly" ref="sections/integrations/02_icingabeat:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Icingabeat</h1>

<p>Icingabeat is an Elastic Beat that fetches data from the Icinga 2 API and sends it either directly to Elasticsearch or Logstash. There are also example dashboards for Kibana available.</p>

<p></p>
<center><img src="./file//sections/integrations/_images/icingabeat-checkresults-dashboard.png" style="width:460px;height:264px;"></center>

<p><strong>Note:</strong> Icingabeat, Elasticsearch and Kibana are already pre-installed on "graphing1.localdomain".</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/Icinga/icingabeat" target="_blank">https://github.com/Icinga/icingabeat</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="02_icingabeat" id="sections_integrations_02_icingabeat3" class="slide" data-transition="none">
<div class="content " ref="sections/integrations/02_icingabeat:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Event Streams</h1>

<p>Icingabeat is pre-configured by default to receive check results (CheckResult) and state changes (StateChange) from Icinga's event stream and send them periodically (every 10s) to Elasticsearch.</p>

<p>Notifications, acknowledgements, comments and downtimes are also available as event streams. We add notifications (Notification) as event stream in our training environment and we have to turn off ssl verification:</p>

<p>File: <strong>/etc/icingabeat/icingabeat.yml</strong></p>

<pre class="highlight"><code class="language-sh">...

ssl.verify: false

eventstream.types:
 - CheckResult
 - StateChange
 - Notification

...</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="02_icingabeat" id="sections_integrations_02_icingabeat4" class="slide" data-transition="none">
<div class="content " ref="sections/integrations/02_icingabeat:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Start Elasticsearch and Icingabeat</h1>

<p>Finally we can start Elasticsearch and Icingabeat:</p>

<pre class="highlight"><code class="language-sh"># systemctl start elasticsearch.service
# systemctl start icingabeat.service</code></pre>

<p><strong>Note:</strong> If you're interested you can also start Kibana, it will be available at: <a href="http://192.168.56.101:5601" target="_blank">http://192.168.56.101:5601</a></p>

<pre class="highlight"><code class="language-sh"># systemctl start kibana.service</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="02_icingabeat" id="sections_integrations_02_icingabeat5" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/integrations/02_icingabeat:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Grafana Elasticsearch Data Source</h1>

<p>Add the Elasticsearch data source with the Icingabeat index "<strong>[icingabeat-*]</strong>" to Grafana:</p>

<p></p>
<center><img src="./file//sections/integrations/_images/grafana-elasticsearch-datasource.png" style="width:460px;height:185px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="02_icingabeat" id="sections_integrations_02_icingabeat6" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/integrations/02_icingabeat:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Notification Annotations</h1>

<p>Create a new graph with <strong>icinga2.training_localdomain.services.random.
random.metadata.state</strong> metrics from Graphite and annotation settings from Elasticsearch:</p>

<p></p>
<center><img src="./file//sections/integrations/_images/grafana-annotations.png" style="width:460px;height:153px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="02_icingabeat" id="sections_integrations_02_icingabeat7" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/integrations/02_icingabeat:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graph with Annotations</h1>

<p>The graph should look similar like this one:</p>

<p></p>
<center><img src="./file//sections/integrations/_images/grafana-graph-with-annotations.png" style="width:460;height:130px;"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="03_modules" id="sections_integrations_03_modules1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/integrations/03_modules:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>12.3 Web Modules</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="03_modules" id="sections_integrations_03_modules2" class="slide" data-transition="none">
<div class="content " ref="sections/integrations/03_modules:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Modules for Icinga Web 2</h1>

<p>Icinga Web 2 can be extended with so called <em>modules</em>. There are some modules available for the integration of Graphite and Grafana.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="03_modules" id="sections_integrations_03_modules3" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/integrations/03_modules:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite Module</h1>

<p>The Graphite module provided from the Icinga project integrates the graphs directly into the Icinga Web 2 interface:</p>

<p></p>
<center><img src="./file//sections/integrations/_images/graphite-module.png" style="width:460px;height:85px;"></center>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/icinga/icingaweb2-module-graphite" target="_blank">https://github.com/icinga/icingaweb2-module-graphite</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="03_modules" id="sections_integrations_03_modules4" class="slide" data-transition="none">
<div class="content " ref="sections/integrations/03_modules:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite Module Installation</h1>

<p>The Graphite module can be installed via git:</p>

<pre class="highlight"><code class="language-sh"># git clone https://github.com/Icinga/\
icingaweb2-module-graphite.git \
/usr/share/icingaweb2/modules/graphite

# cd /usr/share/icingaweb2/modules/graphite/
# git checkout v1.0.1</code></pre>

<p>After that the module must be enabled and adapted to the environment:</p>

<pre class="highlight"><code class="language-sh"># icingacli module enable graphite</code></pre>

<p>File: <strong>/etc/icingaweb2/modules/graphite/config.ini</strong></p>

<pre class="highlight"><code class="language-sh">[graphite]
url = "http://graphite"
insecure = "1"</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="03_modules" id="sections_integrations_03_modules5" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/integrations/03_modules:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Grafana Module</h1>

<p>An Icinga Web 2 module that retrieves graphs from Grafana is provided from GitHub user "mikesch-mp":</p>

<p></p>
<center><img src="./file//sections/integrations/_images/grafana-module.png" style="width:460px;height:221px;"></center>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/Mikesch-mp/icingaweb2-module-grafana" target="_blank">https://github.com/Mikesch-mp/icingaweb2-module-grafana</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/integrations/" data-title="03_modules" id="sections_integrations_03_modules6" class="slide small" data-transition="none">
<div class="content small" ref="sections/integrations/03_modules:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Integrations</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Grafana Module Configuration</h1>

<p>The Grafana module provides two default dashboards <code>base-metrics.json</code> and <code>icinga2-default.json</code> which have to be imported into Grafana.</p>

<p>After that Icinga Web 2 needs a configuration in order to use Grafana as backend for the module in <strong>/etc/icingaweb2/modules/grafana/config.ini</strong>:</p>

<pre class="highlight"><code class="language-sh">[grafana]
host = 192.168.56.101:3000
datasource = "graphite"
username = "admin"
password = "admin"
accessmode = "proxy"</code></pre>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="00_title" id="sections_alternatives_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/alternatives/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>13 Alternatives</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="01_transport" id="sections_alternatives_01_transport1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/alternatives/01_transport:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>13.1 Transports</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="01_transport" id="sections_alternatives_01_transport2" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/01_transport:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Transport Alternatives</h1>

<p>There are a few alternatives for Carbon Relay and/or Carbon Aggregator.</p>

<p>They are written in other languages than Python and aim to be faster. Also they provide more features.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Overview: <a href="http://graphite.readthedocs.io/en/latest/tools.html#forwarding" target="_blank">http://graphite.readthedocs.io/en/latest/tools.html#forwarding</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="01_transport" id="sections_alternatives_01_transport3" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/01_transport:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>carbon-c-relay</h1>

<ul>
<li>Written in C</li>
<li>Cleansing of received metrics</li>
<li>Support for multiple clusters</li>
<li>Lots of relay methods available

<ul>
<li>forward (all destinations)</li>
<li>any_of (one destination)</li>
<li>failover (usually first destination)</li>
<li>carbon_ch (distribute metrics)</li>
</ul>
</li>
<li>Rewrite rules</li>
<li>Aggregation functionality</li>
<li>Plaintext input</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/grobian/carbon-c-relay" target="_blank">https://github.com/grobian/carbon-c-relay</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="01_transport" id="sections_alternatives_01_transport4" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/01_transport:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>carbon-relay-ng</h1>

<ul>
<li>Written in Go</li>
<li>Validation on all incoming metrics</li>
<li>Adjust the routing table in runtime</li>
<li>Web and telnet interface</li>
<li>Advanced routing functions (i.e. queue data to disk)

<ul>
<li>sendAllMatch (all destinations)</li>
<li>sendFirstMatch (first destination)</li>
<li>consistentHashing (distribute metrics)</li>
</ul>
</li>
<li>Rewrite rules</li>
<li>Aggregation functionality</li>
<li>Plaintext, pickle and AMQP input</li>
<li>Plaintext, pickle, metrics 2.0 and kafka output</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/graphite-ng/carbon-relay-ng" target="_blank">https://github.com/graphite-ng/carbon-relay-ng</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="01_transport" id="sections_alternatives_01_transport5" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/01_transport:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>graphite-relay</h1>

<ul>
<li>Written with Netty</li>
<li>Different backend strategies</li>
<li>Overflow handler</li>
<li>Plaintext input</li>
<li>No active development since 2012</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/markchadwick/graphite-relay" target="_blank">https://github.com/markchadwick/graphite-relay</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="02_cache" id="sections_alternatives_02_cache1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/alternatives/02_cache:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>13.2 Cache</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="02_cache" id="sections_alternatives_02_cache2" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/alternatives/02_cache:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>go-carbon Overview</h1>

<p><em>go-carbon</em> is a re-implementation of Carbon Cache written in Go.</p>

<p></p>
<center><img src="./file//sections/alternatives/_images/go-carbon.png" style="width:460px;height:159px;"></center>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/lomik/go-carbon" target="_blank">https://github.com/lomik/go-carbon</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="02_cache" id="sections_alternatives_02_cache3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/alternatives/02_cache:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>go-carbon Features</h1>

<ul>
<li>Receive metrics from TCP and UDP (plaintext protocol)</li>
<li>Receive metrics with Pickle protocl (TCP only)</li>
<li>Receive metrics from HTTP and Apache Kafka</li>
<li>Uses same configuration files as Carbon Cache</li>
<li>Automatic config reload for many configuration sections</li>
<li>Acts as carbonlink for Graphite-Web (port 7002)</li>
<li>Writes statistics about itself</li>
<li>Supports <em>carbonapi</em>, which is useful in supported setups</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="02_cache" id="sections_alternatives_02_cache4" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/alternatives/02_cache:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>go-carbon Pros/Cons</h1>

<ul>
<li>
<p>Pros:</p>

<ul>
<li>Requests to carbonlink are faster than with Carbon Cache</li>
<li>Configuration and deployment is easy</li>
<li>Daemon spawns workers automatically, no need for separate configuration</li>
<li>Constant development since 2015</li>
</ul>
</li>
<li>
<p>Cons:</p>

<ul>
<li>Current Graphite-Web implementation is experimental</li>
<li>Still needs Graphite-Web to access metrics</li>
</ul>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="03_storage" id="sections_alternatives_03_storage1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/alternatives/03_storage:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>13.3 Storage Backends</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="03_storage" id="sections_alternatives_03_storage2" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/03_storage:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Whisper Alternatives</h1>

<ul>
<li>File Based

<ul>
<li>Ceres</li>
<li>Round-Robin Database</li>
<li>Go Whisper</li>
</ul>
</li>
<li>Based on LevelDB

<ul>
<li>InfluxDB (already seen)</li>
</ul>
</li>
<li>Based on HBase

<ul>
<li>OpenTSDB (already seen)</li>
</ul>
</li>
<li>Based on Cassandra

<ul>
<li>Cyanite</li>
<li>KairosDB</li>
<li>BigGraphite</li>
</ul>
</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Overview: <a href="http://graphite.readthedocs.io/en/latest/tools.html#storage-backend-alternates" target="_blank">http://graphite.readthedocs.io/en/latest/tools.html#storage-backend-alternates</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="03_storage" id="sections_alternatives_03_storage3" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/03_storage:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Ceres</h1>

<p><em>Ceres</em> is an alternative time-series database to Whisper. It is intended to replace Whisper as the default storage for Graphite.</p>

<ul>
<li>Not fixed-sized</li>
<li>Calculate timestamps instead of storing them for each datapoint</li>
<li>Store datapoints of one metric across multiple servers</li>
</ul>

<p>Unfortunately <em>Ceres</em> is not intended to be used in production yet. <em>Ceres</em> is not actively maintained, so there is no roadmap if and when a final release will happen.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/graphite-project/ceres" target="_blank">https://github.com/graphite-project/ceres</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="03_storage" id="sections_alternatives_03_storage4" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/03_storage:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Round-Robin Database</h1>

<p><em>Round-Robin Database</em> (RRD) is well-known by many Open Source tools like Cacti, MRTG, Munin or PNP4Nagios. Usually they use RRDtool to store their data into RRD-files.</p>

<p>Graphite-Web has included support for RRD since the very beginning. It is a fixed-size database, similar in design and purpose to Whisper.</p>

<p>Differences compared to Whisper are:</p>

<ul>
<li>Can not take updates to a time-slot prior to its most recent update</li>
<li>RRD was not designed with irregular updates in mind</li>
<li>Updates are staged first for aggregation and written later</li>
<li>More disk space efficient than Whisper</li>
<li>Little bit faster than Whisper due to the fact it's written in C</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://oss.oetiker.ch/rrdtool/" target="_blank">https://oss.oetiker.ch/rrdtool/</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="03_storage" id="sections_alternatives_03_storage5" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/03_storage:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Go Whisper</h1>

<p><em>Go Whisper</em> is a Go implementation of Whisper. To create a new Whisper database you must define it's retention level(s), aggregation method and the xFilesFactor.</p>

<ul>
<li>Not thread safe on concurrent writes</li>
<li>Still in development</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/lomik/go-whisper" target="_blank">https://github.com/lomik/go-whisper</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="03_storage" id="sections_alternatives_03_storage6" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/03_storage:6">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Cyanite</h1>

<p><em>Cyanite</em> is an Apache Cassandra based time-series database designed to be API-compatible with the Graphite eco-system and easy to scale.</p>

<p><em>Graphite-Cyanite</em> is the so called storage finder and the component between the Cyanite backend and the Graphite Render API. It prefers the <em>Graphite-API</em> to Graphite-Web.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/pyr/cyanite" target="_blank">https://github.com/pyr/cyanite</a><br>
Docs: <a href="http://cyanite.io" target="_blank">http://cyanite.io</a><br>
Storage Finder: <a href="https://github.com/brutasse/graphite-cyanite" target="_blank">https://github.com/brutasse/graphite-cyanite</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="03_storage" id="sections_alternatives_03_storage7" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/03_storage:7">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>KairosDB</h1>

<p><em>KairosDB</em> is a TSDB similar to OpenTSDB but built on top of Cassandra.</p>

<p><em>cairos-carbon</em> is a re-implementation of Carbon in Java and feeds KairosDB with support for the plaintext protocol.</p>

<p>A storage finder for Graphite-Web called <em>graphite-kairosdb</em> is provided from <em>raintank</em>.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://kairosdb.github.io" target="_blank">https://kairosdb.github.io</a><br>
Carbon Support: <a href="https://github.com/kairosdb/kairos-carbon" target="_blank">https://github.com/kairosdb/kairos-carbon</a><br>
Storage Finder: <a href="https://github.com/raintank/graphite-kairosdb" target="_blank">https://github.com/raintank/graphite-kairosdb</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="03_storage" id="sections_alternatives_03_storage8" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/03_storage:8">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>BigGraphite</h1>

<p><em>BigGraphite</em> is a storage layer for timeseries data. It integrates with Graphite as a plugin and was developed at Criteo.</p>

<p>The only supported database backend by now is Apache Cassandra.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/criteo/biggraphite" target="_blank">https://github.com/criteo/biggraphite</a><br>
Announcement: <a href="https://github.com/criteo/biggraphite/wiki/BigGraphite-Announcement" target="_blank">https://github.com/criteo/biggraphite/wiki/BigGraphite-Announcement</a><br>
Storage Finder: <a href="https://github.com/criteo/biggraphite/blob/master/biggraphite/plugins/graphite.py" target="_blank">https://github.com/criteo/biggraphite/blob/master/biggraphite/plugins/graphite.py</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="04_api" id="sections_alternatives_04_api1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/alternatives/04_api:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>13.4 API</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="04_api" id="sections_alternatives_04_api2" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/04_api:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-API</h1>

<ul>
<li>Only functionality of Graphite-Web's Render API</li>
<li>No serverside rendering</li>
<li>No database</li>
<li>Easy to install and configure</li>
<li>Originally developed for Cyanite</li>
<li>Last release in 2016</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/brutasse/graphite-api" target="_blank">https://github.com/brutasse/graphite-api</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="05_stacks" id="sections_alternatives_05_stacks1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/alternatives/05_stacks:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>13.5 Stacks</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="05_stacks" id="sections_alternatives_05_stacks2" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/05_stacks:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Zipper</h1>

<ul>
<li>Written in Go</li>
<li>Originally developed at booking.com</li>
<li>Can query store servers in parallel</li>
<li>Can "zip" the data</li>
<li>Consists of:

<ul>
<li>carbonzipper</li>
<li>carbonapi</li>
<li>carbonserver (since December 2016 part of go-carbon)</li>
<li>carbonsearch</li>
</ul>
</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>carbonzipper: <a href="https://github.com/go-graphite/carbonzipper" target="_blank">https://github.com/go-graphite/carbonzipper</a><br>
carbonapi: <a href="https://github.com/go-graphite/carbonapi" target="_blank">https://github.com/go-graphite/carbonapi</a><br>
carbonserver: <a href="https://github.com/grobian/carbonserver" target="_blank">https://github.com/grobian/carbonserver</a><br>
carbonsearcht: <a href="https://github.com/kanatohodets/carbonsearch" target="_blank">https://github.com/kanatohodets/carbonsearch</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="05_stacks" id="sections_alternatives_05_stacks3" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/05_stacks:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Zipper Stack Architecture</h1>

<p>Example architecture of the Zipper Stack:</p>

<p></p>
<center><img src="./file//sections/alternatives/_images/zipperstack.png"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="05_stacks" id="sections_alternatives_05_stacks4" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/05_stacks:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>ClickHouse</h1>

<p><em>ClickHouse</em> is an Open Source column-oriented database management system developed from Yandex that allows generating analytical data reports in real time.</p>

<p><em>carbon-clickhouse</em> is a metrics receiver that uses ClickHouse as storage. The connection from Graphite-Web to the cluster backend <em>graphite-clickhouse</em> including ClickHouse support is configured with <code>CLUSTER_SERVERS</code> in <strong>local_settings.py</strong>.</p>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Carbon Support: <a href="https://github.com/lomik/carbon-clickhouse" target="_blank">https://github.com/lomik/carbon-clickhouse</a><br>
Cluster Backend: <a href="https://github.com/lomik/graphite-clickhouse" target="_blank">https://github.com/lomik/graphite-clickhouse</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="05_stacks" id="sections_alternatives_05_stacks5" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/alternatives/05_stacks:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>ClickHouse Architecture</h1>

<p>Work scheme for Graphite with ClickHouse support:</p>

<p></p>
<center><img src="./file//sections/alternatives/_images/clickhouse.png" style="width:420px;height:426px;"></center>

<p><strong>Note:</strong> The gray components are optional or alternative.</p>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="06_dashboard" id="sections_alternatives_06_dashboard1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/alternatives/06_dashboard:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>13.6 Dashboards</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="06_dashboard" id="sections_alternatives_06_dashboard2" class="slide" data-transition="none">
<div class="content " ref="sections/alternatives/06_dashboard:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Dashboard Alternatives</h1>

<ul>
<li>Grafana (already seen)</li>
<li>Tasseo </li>
<li>Dusk</li>
<li>Dashing</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Overview: <a href="http://graphite.readthedocs.io/en/latest/tools.html#visualization" target="_blank">http://graphite.readthedocs.io/en/latest/tools.html#visualization</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="06_dashboard" id="sections_alternatives_06_dashboard3" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/alternatives/06_dashboard:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Tasseo</h1>

<ul>
<li>Live dashboard</li>
<li>Supports Graphite, InfluxDB, Librato Metrics and Amazon Cloud Watch backend sources</li>
</ul>

<p></p>
<center><img src="./file//sections/alternatives/_images/tasseo.png" style="width:460;height:51px;"></center>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/obfuscurity/tasseo" target="_blank">https://github.com/obfuscurity/tasseo</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="06_dashboard" id="sections_alternatives_06_dashboard4" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/alternatives/06_dashboard:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Dusk</h1>

<ul>
<li>Based on Cubism.js</li>
<li>Find hotspots across a range of values in the same metric domain</li>
<li>Beta stadium</li>
</ul>

<p></p>
<center><img src="./file//sections/alternatives/_images/dusk.png" style="width:460px;height:250px;"></center>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/obfuscurity/dusk" target="_blank">https://github.com/obfuscurity/dusk</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/alternatives/" data-title="06_dashboard" id="sections_alternatives_06_dashboard5" class="slide printonly" data-transition="none">
<div class="content printonly" ref="sections/alternatives/06_dashboard:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Alternatives</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Dashing</h1>

<ul>
<li>Sinatra based framework</li>
<li>Pushes data to widgets</li>
<li>Currently out of maintenance</li>
</ul>

<p></p>
<center><img src="./file//sections/alternatives/_images/dashing.png" style="width:440px;height:265px;"></center>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="http://dashing.io" target="_blank">http://dashing.io</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="00_title" id="sections_optimization_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/optimization/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>14 Optimization</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="01_storage" id="sections_optimization_01_storage1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/optimization/01_storage:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>14.1 Storage</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="01_storage" id="sections_optimization_01_storage2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/optimization/01_storage:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Whisper Limitations</h1>

<ul>
<li>Performance is slower than RRD, since Whisper is written in Python</li>
<li>Whisper is disk space inefficient</li>
<li>Updates end up involving a lot of IO calls</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="01_storage" id="sections_optimization_01_storage3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/optimization/01_storage:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Optimize Storage</h1>

<ul>
<li>Reduce incoming datapoints</li>
<li>Use blacklisting</li>
<li>Better aggregation</li>
<li>Reduce retention times</li>
<li>Less retentions</li>
<li>Keep a lower granularity</li>
<li>Optimize Cache</li>
<li>Replace with alternative Storage</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="02_cache" id="sections_optimization_02_cache1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/optimization/02_cache:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>14.2 Cache</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="02_cache" id="sections_optimization_02_cache2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/optimization/02_cache:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Cache Limitations</h1>

<ul>
<li>Cache is not able to keep up with incoming datapoints</li>
<li>Incoming datapoints are dropped or in waiting line</li>
<li>System runs out of memory when <code>MAX_CACHE_SIZE</code> is set to high</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="02_cache" id="sections_optimization_02_cache3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/optimization/02_cache:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Optimize Cache (1/2)</h1>

<ul>
<li>Adjust <code>MAX_CREATES_PER_MINUTE</code> (Defaults to <code>50</code>)</li>
<li>Adjust <code>MAX_CACHE_SIZE</code> (Defaults to <code>inf</code>)</li>
<li>Adjust <code>CACHE_WRITE_STRATEGY</code> (Defaults to <code>sorted</code>)

<ul>
<li>
<code>max</code> reduces random I/O</li>
<li>
<code>naive</code> only with fast I/O and limited CPU resources</li>
</ul>
</li>
<li>Set <code>WHISPER_AUTOFLUSH</code> when writing to slow disks (Defaults to <code>False</code>)</li>
<li>Set <code>WHISPER_SPARSE_CREATE</code> for faster creates (Defaults to <code>False</code>)</li>
<li>Set <code>WHISPER_LOCK_WRITES</code> when multiple Carbon Caches write to the same files (Defaults to <code>False</code>)</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="02_cache" id="sections_optimization_02_cache4" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/optimization/02_cache:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Optimize Cache (2/2)</h1>

<ul>
<li>Increase page cache (disk cache) for less read iops</li>
<li>Spawn Cache on same system (vertical scaling)</li>
<li>Distribute Cache over more systems (horizontal scaling)</li>
<li>Replace slow disks with faster ones (SSD's) for better write iops</li>
<li>Replace with alternative Cache (<em>go-carbon</em>)</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="03_forward" id="sections_optimization_03_forward1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/optimization/03_forward:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>14.3 Forwarding</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="03_forward" id="sections_optimization_03_forward2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/optimization/03_forward:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Relay Limitations</h1>

<ul>
<li>Queue is growing continuously</li>
<li>Incoming datapoints are dropped or in waiting line</li>
<li>System runs out of memory when <code>MAX_QUEUE_SIZE</code> is set to high</li>
<li>Only <em>consistent-hashing</em> or <em>regex based routing</em> supported</li>
<li>No aggregation functionality</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="03_forward" id="sections_optimization_03_forward3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/optimization/03_forward:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Optimize Relay</h1>

<ul>
<li>Adjust <code>MAX_QUEUE_SIZE</code> (Defaults to <code>10000</code>)</li>
<li>Set <code>USE_FLOW_CONTROL</code> (Defaults to <code>True</code>)</li>
<li>Adjust <code>QUEUE_LOW_WATERMARK_PCT</code> (Defaults to <code>0.08</code>)</li>
<li>Adjust <code>MAX_DATAPOINTS_PER_MESSAGE</code> (Defaults to <code>500</code>)</li>
<li>Put Aggregator afterwards</li>
<li>Optimize Cache or Aggregator aftwards</li>
<li>Replace with alternative Relay</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="03_forward" id="sections_optimization_03_forward4" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/optimization/03_forward:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Carbon Aggregator Limitations</h1>

<ul>
<li>Queue is growing continuously</li>
<li>Incoming datapoints are dropped or in waiting line</li>
<li>System runs out of memory when <code>MAX_QUEUE_SIZE</code> is set to high</li>
<li>Only <em>consistent-hashing</em> supported</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="03_forward" id="sections_optimization_03_forward5" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/optimization/03_forward:5">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Optimize Aggregator</h1>

<ul>
<li>Adjust <code>MAX_QUEUE_SIZE</code> (Defaults to <code>10000</code>)</li>
<li>Set <code>USE_FLOW_CONTROL</code> (Defaults to <code>True</code>)</li>
<li>Adjust <code>QUEUE_LOW_WATERMARK_PCT</code> (Defaults to <code>0.08</code>)</li>
<li>Adjust <code>MAX_DATAPOINTS_PER_MESSAGE</code> (Defaults to <code>500</code>)</li>
<li>Put Relay afterwards</li>
<li>Optimize Cache or Relay afterwards</li>
<li>Replace with alternative Aggregator</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="04_webapp" id="sections_optimization_04_webapp1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/optimization/04_webapp:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>14.4 Webapp</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="04_webapp" id="sections_optimization_04_webapp2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/optimization/04_webapp:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite-Web Limitations</h1>

<ul>
<li>Performance impacts</li>
<li>Awkward operation</li>
<li>Configuration of Django is very complex</li>
<li>Overhead when only API is needed</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/optimization/" data-title="04_webapp" id="sections_optimization_04_webapp3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/optimization/04_webapp:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Optimization</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Optimize Webapp</h1>

<ul>
<li>Generate index</li>
<li>Use memcached </li>
<li>Use dashboard alternatives</li>
<li>Use alernatives that provide only API functionality</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/bestpractice/" data-title="00_title" id="sections_bestpractice_00_title" class="slide subsection" data-transition="none">
<div class="content subsection" ref="sections/bestpractice/00_title">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Best Practice</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>15 Best Practice</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/bestpractice/" data-title="01_considerations" id="sections_bestpractice_01_considerations1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/bestpractice/01_considerations:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Best Practice</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>15.1 Considerations</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/bestpractice/" data-title="01_considerations" id="sections_bestpractice_01_considerations2" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/bestpractice/01_considerations:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Best Practice</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Setup</h1>

<ul>
<li>Use fast disks (SSD's) and as many CPU cores as possible</li>
<li>Use toolstack that fits to the environment</li>
<li>Prefer Pickle protocol over Plaintext</li>
<li>Care about Storage Schemas and Retentions</li>
<li>Always keep scaling in mind</li>
<li>Benchmark the whole installation</li>
<li>Tune the installation</li>
<li>Benchmark the whole installation again</li>
<li>Know the limits of the installation</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/bestpractice/" data-title="01_considerations" id="sections_bestpractice_01_considerations3" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/bestpractice/01_considerations:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Best Practice</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Operating</h1>

<ul>
<li>Keep an eye of internal statistics (Monitoring!)

<ul>
<li>Queues</li>
<li>Caches</li>
</ul>
</li>
<li>Keep an eye of system statistics (Monitoring!)

<ul>
<li>IO reads and writes (iostat, iotop, collectl, dstat, sar, ...)</li>
<li>CPU utilization (top/htop, iostat, collectl, dstat, sar, ...)</li>
<li>Memory usage (top/htop, collectl, dstat, sar, ...)</li>
<li>Network performance (iperf, iftop, tcpdump, nload, dstat, sar, ...)</li>
<li>Disk usage (df, ...)</li>
</ul>
</li>
</ul>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/bestpractice/" data-title="01_considerations" id="sections_bestpractice_01_considerations4" class="slide smbullets" data-transition="none">
<div class="content smbullets" ref="sections/bestpractice/01_considerations:4">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Best Practice</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Maintenance</h1>

<ul>
<li>Think about backups (Validation!)</li>
<li>Think about disaster recovery (Tests!)</li>
<li>Consider updates</li>
<li>Cleanup orphaned or corrupt Whisper files</li>
<li>Validate Storage Schemas and Retentions </li>
<li>Resize Whisper files</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Example command to cleanup orphaned Whisper files:</p>

<pre class="highlight"><code class="language-sh"># find /opt/graphite/storage/whisper/ -type f \
-name *.wsp -mtime +60 -delete</code></pre>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/bestpractice/" data-title="02_benchmarking" id="sections_bestpractice_02_benchmarking1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/bestpractice/02_benchmarking:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Best Practice</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>15.2 Benchmarking</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/bestpractice/" data-title="02_benchmarking" id="sections_bestpractice_02_benchmarking2" class="slide small" data-transition="none">
<div class="content small" ref="sections/bestpractice/02_benchmarking:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Best Practice</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Haggar - Carbon Load Generation Tool</h1>

<p>Installation and run on CentOS:</p>

<pre class="highlight"><code class="language-sh"># yum -y install golang
# go get github.com/gorsuch/haggar

# /root/go/bin/haggar -agents=5 -metrics=10 \
-carbon="127.0.0.1:2003"

2018/03/01 11:15:28 master: pid 12863
2018/03/01 11:15:28 agent 0: launched
2018/03/01 11:15:38 agent 0: flushed 10 metrics
2018/03/01 11:15:40 agent 1: launched
2018/03/01 11:15:42 agent 2: launched
2018/03/01 11:15:48 agent 0: flushed 10 metrics
2018/03/01 11:15:50 agent 1: flushed 10 metrics
2018/03/01 11:15:52 agent 2: flushed 10 metrics
2018/03/01 11:15:58 agent 0: flushed 10 metrics
2018/03/01 11:15:58 agent 3: launched
2018/03/01 11:16:00 agent 1: flushed 10 metrics
2018/03/01 11:16:00 agent 4: launched
2018/03/01 11:16:02 agent 2: flushed 10 metrics
...</code></pre>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://github.com/gorsuch/haggar" target="_blank">https://github.com/gorsuch/haggar</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/bestpractice/" data-title="02_benchmarking" id="sections_bestpractice_02_benchmarking3" class="slide" data-transition="none">
<div class="content " ref="sections/bestpractice/02_benchmarking:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Best Practice</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>bonnie++ - File System Benchmark</h1>

<p>Benchmark file system performance:</p>

<ul>
<li>Data read and write speed</li>
<li>Number of seeks that can be performed per second</li>
<li>Number of file metadata operations that can be performed per second</li>
</ul>

<p></p>
<center><img src="./file//sections/bestpractice/_images/bonnie.png" style="width:90%"></center>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Project: <a href="https://www.coker.com.au/bonnie++/" target="_blank">https://www.coker.com.au/bonnie++/</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/bestpractice/" data-title="03_information" id="sections_bestpractice_03_information1" class="slide subsectionnonum" data-transition="none">
<div class="content subsectionnonum" ref="sections/bestpractice/03_information:1">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Best Practice</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>15.3 Information Resources</h1>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/bestpractice/" data-title="03_information" id="sections_bestpractice_03_information2" class="slide" data-transition="none">
<div class="content " ref="sections/bestpractice/03_information:2">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Best Practice</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Information Resources</h1>

<p>Keep informed!</p>

<ul>
<li>Documentation</li>
<li>GitHub projects</li>
<li>Social Media</li>
<li>StackExchange</li>
<li>IRC channel</li>
<li>Meetups and Conferences (e.g. GrafanaCon)</li>
</ul>



<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<div class="notes-section handouts">

<hr>

<p>Docs: <a href="http://graphite.readthedocs.org/en/latest/" target="_blank">http://graphite.readthedocs.org/en/latest/</a><br>
StackExchange: <a href="http://stackexchange.com/filters/27311/graphite" target="_blank">http://stackexchange.com/filters/27311/graphite</a><br>
IRC channel: <a href="http://irc.netsplit.de/channels/details.php?room=%23graphite&amp;net=freenode" target="_blank">http://irc.netsplit.de/channels/details.php?room=%23graphite&amp;net=freenode</a><br>
GitHub projects: <a href="https://github.com/graphite-project" target="_blank">https://github.com/graphite-project</a></p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="sections/bestpractice/" data-title="03_information" id="sections_bestpractice_03_information3" class="slide" data-transition="none">
<div class="content " ref="sections/bestpractice/03_information:3">
<h1 class="section_title">~~~SECTION:MAJOR~~~ Best Practice</h1>
<div class="net-header">
    <img src="./file///global/pre/netways/_images/Schulung_Stammlogo_2000px_ENG.jpg" alt="NETWAYS Training" width="215px" height="100px">
</div>

<h1>Graphite Book</h1>

<p></p>
<center><img src="./file//sections/bestpractice/_images/graphite_book.jpg" style="width:350px"></center>

<div class="net-footer">
    <p>Open Source Training</p>
    <p>by NETWAYS (netways.de)</p>
</div>
</div>
<canvas class="annotations"></canvas>
</div>

</div>
</body>
</html>
